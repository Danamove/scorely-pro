
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scorely - AI-Powered LinkedIn Profile Ranking Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%) !important;
        }
        
        .file-upload-zone { 
            position: relative; 
            border: 2px dashed #3b82f6;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            background-color: #f8fafc;
            transition: all 0.3s ease;
        }

        .file-upload-zone:hover {
            border-color: #1d4ed8;
            background-color: #eff6ff;
        }

        .file-upload-zone input[type="file"] {
            position: absolute;
            top: 0; 
            left: 0;
            width: 100%; 
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .file-upload-zone .upload-text {
            pointer-events: none;
            color: #374151;
            font-weight: 500;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
        }

        .close-button:hover {
            color: black;
        }

        #mappingModal .modal-content {
            max-width: 400px;
        }

        .fixed.bottom-0 {
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(8px);
            background-color: rgba(255, 255, 255, 0.95);
        }

        .status-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 1.5rem;
            color: white;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .status-number {
            font-size: 2rem;
            font-weight: bold;
            display: block;
        }

        .status-label {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-top: 0.25rem;
        }

         {
            .no-print {
                display: none !important;
            }
            
            body {
                padding: 0 !important;
                margin: 0 !important;
            }
            
            .container {
                max-width: none !important;
                padding: 0 !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Global Message Container -->
    <div id="globalMessage" class="container mx-auto px-4"></div>

    <!-- Header -->
    <header class="gradient-bg text-white py-8 mb-8">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-4xl font-bold text-white mb-2">üî• Scorely</h1>
            <p class="text-xl text-blue-100">AI-Powered LinkedIn Profile Ranking Tool</p>
            <div class="mt-4 flex justify-center space-x-4">
                <span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm">AI Optimized</span>
                <span class="bg-blue-500 text-white px-3 py-1 rounded-full text-sm">Smart Pre-Filter</span>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-white shadow-sm border-b no-print">
        <div class="container mx-auto px-4">
            <div class="flex space-x-1">
                <button onclick="showPage('setup')" id="setupTab" class="px-4 py-3 text-sm font-medium text-blue-600 border-b-2 border-blue-600">
                    <i class="fas fa-cog mr-2"></i>Setup
                </button>
                <button onclick="showPage('ranking')" id="rankingTab" class="px-4 py-3 text-sm font-medium text-gray-500 hover:text-gray-700">
                    <i class="fas fa-chart-line mr-2"></i>Ranking
                </button>
                <button onclick="showPage('results')" id="resultsTab" class="px-4 py-3 text-sm font-medium text-gray-500 hover:text-gray-700">
                    <i class="fas fa-table mr-2"></i>Results
                </button>
                <button onclick="showPage('below60')" id="below60Tab" class="px-4 py-3 text-sm font-medium text-gray-500 hover:text-gray-700">
                    <i class="fas fa-exclamation-triangle mr-2"></i>Below 60
                </button>
                <button onclick="showPage('export')" id="exportTab" class="px-4 py-3 text-sm font-medium text-gray-500 hover:text-gray-700">
                    <i class="fas fa-download mr-2"></i>Export
                </button>
            </div>
        </div>
    </nav>

    <!-- Setup Page -->
    <div id="setupPage" class="container mx-auto px-4 py-6">
        <!-- API Key Management -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">üîë API Key Management</h3>
            <p class="text-gray-600 mb-4">Please enter your OpenAI API key to continue</p>
            <div class="flex gap-2">
                <input type="password" 
                       id="openaiApiKey" 
                       class="flex-1 border border-gray-300 rounded-md px-3 py-2" 
                       placeholder="sk-...">
                <button onclick="saveApiKey()" 
                        id="saveApiKeyBtn" 
                        class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                    üíæ Save API Key
                </button>
                <button onclick="testConnection()" 
                        id="testConnectionBtn" 
                        class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700" 
                        disabled>
                    üîç Test Connection
                </button>
            </div>
        </div>

        <!-- File Upload & Advanced Filtering -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">üìÅ File Upload & Advanced Filtering</h3>
            
            <div class="mb-6">
                <h4 class="font-semibold mb-3">Main CSV File</h4>
                <p class="text-gray-600 mb-3">LinkedIn profiles data</p>
                <div class="file-upload-zone">
                    <input type="file" 
                           id="mainCsvFile" 
                           accept=".csv,.xlsx" 
                           onchange="handleMainFileUpload(event)">
                    <div class="upload-text">
                        <i class="fas fa-cloud-upload-alt text-4xl text-blue-500 mb-2"></i>
                        <p class="text-lg">Click to upload or drag and drop</p>
                        <p class="text-sm text-gray-500">LinkedIn profiles data</p>
                    </div>
                </div>
                <div id="mainFileStatus" class="mt-3"></div>
            </div>

            <!-- Blacklist -->
            <div class="mb-6">
                <h4 class="font-semibold mb-3">Blacklist (Optional)</h4>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium mb-1">Manual Entry:</label>
                        <textarea id="blacklistTextarea" 
                                  class="w-full border rounded px-3 py-2 h-24" 
                                  placeholder="Enter company names (one per line)"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Or Upload File:</label>
                        <input type="file" id="blacklistFile" accept=".csv,.txt" 
                               onchange="handleBlacklistFileUpload(event)" 
                               class="w-full border rounded px-3 py-2">
                    </div>
                    <div class="flex gap-2">
                        <button onclick="saveBlacklist()" class="bg-blue-600 text-white px-4 py-2 rounded">üíæ Save</button>
                        <button onclick="clearBlacklist()" class="bg-red-600 text-white px-4 py-2 rounded">üóëÔ∏è Clear</button>
                    </div>
                </div>
            </div>

            <!-- In Process -->
            <div class="mb-6">
                <h4 class="font-semibold mb-3">In Process (Optional)</h4>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium mb-1">Manual Entry:</label>
                        <textarea id="inProcessTextarea" 
                                  class="w-full border rounded px-3 py-2 h-24" 
                                  placeholder="Enter LinkedIn URLs or names (one per line)"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Or Upload File:</label>
                        <input type="file" id="inProcessFile" accept=".csv,.txt" 
                               onchange="handleInProcessFileUpload(event)" 
                               class="w-full border rounded px-3 py-2">
                    </div>
                    <div class="flex gap-2">
                        <button onclick="saveInProcess()" class="bg-blue-600 text-white px-4 py-2 rounded">üíæ Save</button>
                        <button onclick="clearInProcess()" class="bg-red-600 text-white px-4 py-2 rounded">üóëÔ∏è Clear</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- No Go Companies -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">üö´ No Go Companies (Critical Elimination)</h3>
            <p class="text-gray-600 mb-4">Candidates who worked at these companies (current or past) will be automatically filtered out before any AI processing:</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <ul class="space-y-1 text-sm">
                        <li>‚Ä¢ Isracard Ltd.</li>
                        <li>‚Ä¢ Harel Insurance</li>
                        <li>‚Ä¢ Bank Leumi</li>
                        <li>‚Ä¢ Amdocs Limited</li>
                    </ul>
                </div>
                <div>
                    <ul class="space-y-1 text-sm">
                        <li>‚Ä¢ Sapiens</li>
                        <li>‚Ä¢ NICE Ltd.</li>
                        <li>‚Ä¢ Maccabi</li>
                        <li>‚Ä¢ Clalit</li>
                    </ul>
                </div>
                <div>
                    <ul class="space-y-1 text-sm">
                        <li>‚Ä¢ Tax Authority</li>
                        <li class="text-gray-500">... and 36 more companies</li>
                    </ul>
                </div>
            </div>

            <div class="mb-4">
                <h4 class="font-semibold mb-2">Add Custom NO GO:</h4>
                <div class="flex gap-2">
                    <input type="text" id="customNoGoInput" placeholder="Company name..." class="flex-1 border rounded px-3 py-2">
                    <button onclick="addCustomNoGo()" class="bg-red-600 text-white px-4 py-2 rounded">Add</button>
                </div>
            </div>
            
            <div class="flex gap-2 mb-6">
                <button onclick="saveNoGoSettings()" class="bg-red-600 text-white px-4 py-2 rounded">üíæ Save NO GO Settings</button>
            </div>

            <!-- Run Filtering Button -->
            <div class="text-center">
                <button onclick="runFiltering()" 
                        id="runFilteringBtn"
                        class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-semibold shadow-lg">
                    üîΩ Run Filtering
                </button>
            </div>
        </div>

        <!-- Filtering Results Section -->
        <div id="filteringResultsSection" style="display: none;" class="bg-white rounded-lg shadow p-6 mb-6">
            <h3 class="text-xl font-bold mb-6">üìä Filtering Results - Live Status Dashboard</h3>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="status-card">
                    <span id="profilesUploaded" class="status-number">0</span>
                    <div class="status-label">Profiles Uploaded</div>
                </div>
                <div class="status-card">
                    <span id="filteredOut" class="status-number">0</span>
                    <div class="status-label">Filtered Out</div>
                </div>
                <div class="status-card">
                    <span id="skippedByEmbedding" class="status-number">0</span>
                    <div class="status-label">Skipped by Embedding</div>
                </div>
                <div class="status-card">
                    <span id="sentToGPT" class="status-number">0</span>
                    <div class="status-label">Sent to GPT</div>
                </div>
            </div>

            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <h4 class="font-semibold mb-2">üí° Next Steps:</h4>
                <p class="text-sm text-gray-700">Your profiles have been filtered and are ready for AI ranking. Navigate to the <strong>Ranking</strong> tab to start the AI analysis process.</p>
            </div>
        </div>

        <!-- Job Description -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">üìù Job Description</h3>
            <textarea id="jobDescriptionInput" 
                      class="w-full border rounded px-3 py-2 h-32" 
                      placeholder="Enter job description or upload PDF..."></textarea>
            <input type="file" id="jobDescriptionFile" accept=".pdf,.txt" 
                   onchange="handleJobDescriptionUpload(event)" 
                   class="mt-2 w-full border rounded px-3 py-2">
            <button onclick="saveJobDescription()" class="mt-2 bg-blue-600 text-white px-4 py-2 rounded">üíæ Save Job Description</button>
        </div>

        <!-- Ideal Profiles & Target Companies -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">‚≠ê Ideal Profiles & Target Companies</h3>
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                <p class="text-sm"><strong>How AI uses this data:</strong> Ideal profiles create benchmarks for ranking accuracy. Target companies receive bonus scoring when candidates have experience there, prioritizing these backgrounds in the final ranking.</p>
            </div>
            
            <div class="mb-6">
                <h4 class="font-semibold mb-3">Ideal Profile 1</h4>
                <textarea id="idealProfile1" 
                          class="w-full border rounded px-3 py-2 h-24" 
                          placeholder="Paste profile or upload PDF..."></textarea>
                <input type="file" id="idealProfileFile1" accept=".pdf,.txt" 
                       onchange="handleIdealProfileUpload(event, 1)" 
                       class="mt-2 w-full border rounded px-3 py-2">
            </div>
            
            <div class="mb-6">
                <h4 class="font-semibold mb-3">Ideal Profile 2</h4>
                <textarea id="idealProfile2" 
                          class="w-full border rounded px-3 py-2 h-24" 
                          placeholder="Paste profile or upload PDF..."></textarea>
                <input type="file" id="idealProfileFile2" accept=".pdf,.txt" 
                       onchange="handleIdealProfileUpload(event, 2)" 
                       class="mt-2 w-full border rounded px-3 py-2">
            </div>
            
            <div class="mb-6">
                <h4 class="font-semibold mb-3">Target Companies (Preferred Experience)</h4>
                <p class="text-gray-600 mb-3">Candidates with experience from these companies will receive bonus scoring:</p>
                <textarea id="targetCompaniesTextarea" 
                          class="w-full border rounded px-3 py-2 h-24" 
                          placeholder="Google&#10;Microsoft&#10;Apple..."></textarea>
                <div class="flex gap-2 mt-2">
                    <button onclick="saveTargetCompanies()" class="bg-green-600 text-white px-4 py-2 rounded">üíæ Save Target Companies</button>
                    <button onclick="clearTargetCompanies()" class="bg-red-600 text-white px-4 py-2 rounded">üóëÔ∏è Clear Target Companies</button>
                </div>
            </div>
            
            <div class="flex gap-2">
                <button onclick="saveIdealProfiles()" class="bg-green-600 text-white px-4 py-2 rounded">üíæ Save Ideal Profiles</button>
                <button onclick="clearIdealProfiles()" class="bg-red-600 text-white px-4 py-2 rounded">üóëÔ∏è Clear All</button>
            </div>
            
            <div id="idealProfilesStatus" class="mt-3 text-sm text-gray-600"></div>
        </div>

        <!-- Smart Screening Criteria -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">üéØ Smart Screening Criteria</h3>
            
            <div class="mb-6">
                <h4 class="font-semibold mb-3">Years of Experience</h4>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Min:</label>
                        <input type="number" id="minExperience" class="w-full border rounded px-3 py-2" value="2" min="0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Max:</label>
                        <input type="number" id="maxExperience" class="w-full border rounded px-3 py-2" value="15" min="0">
                    </div>
                </div>
            </div>
            
            <div class="mb-6">
                <h4 class="font-semibold mb-3">Academic Degree</h4>
                <select id="academicDegree" class="w-full border rounded px-3 py-2">
                    <option value="any">Any degree</option>
                    <option value="bachelor">Bachelor's degree minimum</option>
                    <option value="master">Master's degree minimum</option>
                    <option value="phd">PhD preferred</option>
                </select>
            </div>

            <!-- Excellence Signals -->
            <div class="mb-6">
                <h4 class="font-semibold mb-3">‚≠ê Excellence Signals (Optional)</h4>
                <p class="text-gray-600 mb-3">Candidates with these get bonus points, but missing them doesn't reduce scores</p>
                
                <div class="space-y-3">
                    <label class="flex items-center">
                        <input type="checkbox" class="mr-2" value="deans_list">
                        <span>Dean's List / Honors</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="mr-2" value="patents">
                        <span>Patents or publications</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="mr-2" value="top_university">
                        <span>Top-tier universities</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="mr-2" value="military">
                        <span>Elite military unit</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="mr-2" value="awards">
                        <span>Awards / Recognitions</span>
                    </label>
                    
                    <div class="flex items-center gap-2">
                        <input type="checkbox" class="mr-2" value="other">
                        <span>Other:</span>
                        <input type="text" id="customExcellenceInput" placeholder="Enter custom excellence signal..." class="border rounded px-2 py-1 flex-1">
                        <button onclick="addCustomExcellence()" class="bg-green-600 text-white px-3 py-1 rounded text-sm">Add</button>
                    </div>
                </div>
                
                <div id="customExcellenceList" class="mt-4 space-y-2"></div>
            </div>

            <!-- Red Flag Patterns -->
            <div class="mb-6">
                <h4 class="font-semibold mb-3">üö© Red Flag Patterns</h4>
                
                <div class="space-y-3">
                    <label class="flex items-center">
                        <input type="checkbox" class="mr-2" value="instability">
                        <span>Instability ‚Äì frequent job changes (&lt;2 years)</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="mr-2" value="stagnation">
                        <span>Stagnation ‚Äì same company &gt;7 years</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="mr-2" value="enterprise">
                        <span>Enterprise-only ‚Äì all jobs in 1000+ orgs</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" class="mr-2" value="freelancer">
                        <span>Freelancer/Consultant ‚Äì independent work pattern</span>
                    </label>
                    
                    <div class="flex items-center gap-2">
                        <input type="checkbox" class="mr-2" value="other">
                        <span>Other:</span>
                        <input type="text" id="customRedFlagInput" placeholder="Enter custom red flag..." class="border rounded px-2 py-1 flex-1">
                        <button onclick="addCustomRedFlag()" class="bg-red-600 text-white px-3 py-1 rounded text-sm">Add</button>
                    </div>
                </div>
                
                <div id="customRedFlagList" class="mt-4 space-y-2"></div>
            </div>

            <!-- Custom Traits -->
            <div class="mb-6">
                <h4 class="font-semibold mb-3">üé® Add Custom Traits</h4>
                
                <div class="bg-blue-50 p-4 rounded-lg mb-4">
                    <h5 class="font-semibold mb-2">Examples:</h5>
                    <ul class="text-sm space-y-1">
                        <li>‚Ä¢ "Experience in SaaS and security companies"</li>
                        <li>‚Ä¢ "Lives in central Israel, prefer profiles living/working in Tel Aviv currently"</li>
                    </ul>
                </div>
                
                <div class="flex gap-2 mb-4">
                    <input type="text" id="customTraitInput" placeholder="Enter custom trait..." class="flex-1 border rounded px-3 py-2">
                    <button onclick="addCustomTrait()" class="bg-green-600 text-white px-4 py-2 rounded">‚ûï Add Trait</button>
                </div>
                
                <div id="customTraitsList" class="space-y-2 mb-4"></div>
                
                <button onclick="saveAllCustomTraits()" class="bg-blue-600 text-white px-4 py-2 rounded">üíæ Save All Traits</button>
            </div>

            <button onclick="saveCriteria()" class="bg-blue-600 text-white px-4 py-2 rounded">üíæ Save Criteria</button>
        </div>

        <!-- AI Model Selection -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">‚öôÔ∏è AI Model Selection</h3>
            
            <div class="space-y-4">
                <label class="flex items-center">
                    <input type="radio" name="aiModel" value="embedding" class="mr-3">
                    <div>
                        <div class="font-semibold">Embedding only</div>
                        <div class="text-sm text-gray-600">Fast, basic similarity scoring</div>
                    </div>
                </label>
                
                <label class="flex items-center">
                    <input type="radio" name="aiModel" value="gpt4mini" class="mr-3" checked>
                    <div>
                        <div class="font-semibold">GPT-4 Turbo (Mini) only</div>
                        <div class="text-sm text-gray-600">Deep analysis, cost-effective</div>
                    </div>
                </label>
                
                <label class="flex items-center">
                    <input type="radio" name="aiModel" value="hybrid" class="mr-3">
                    <div>
                        <div class="font-semibold">Hybrid (Embedding + GPT-4 Turbo Mini)</div>
                        <div class="text-sm text-gray-600">Best results, GPT-4 Turbo primary with GPT-3.5 fallback only on errors</div>
                    </div>
                </label>
            </div>
            
            <button onclick="saveAIModelSelection()" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded">üíæ Save Model Selection</button>
        </div>

        <!-- Scoring Weights -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">üìä Customize Scoring Weights</h3>
            
            <p class="text-gray-600 mb-4">How AI Calculates Scores:</p>
            
            <div class="space-y-4">
                <div>
                    <label class="block font-semibold mb-1">Tech Fit: <span id="techFitValue">30</span>%</label>
                    <div class="text-sm text-gray-600 mb-2">Matches technical skills, tools, programming languages, frameworks</div>
                    <input type="range" id="techFitSlider" min="0" max="50" value="30" class="w-full" onchange="updateWeight('techFit', this.value)">
                </div>
                
                <div>
                    <label class="block font-semibold mb-1">Experience: <span id="experienceValue">25</span>%</label>
                    <div class="text-sm text-gray-600 mb-2">Years in role, seniority level, career progression, leadership</div>
                    <input type="range" id="experienceSlider" min="0" max="50" value="25" class="w-full" onchange="updateWeight('experience', this.value)">
                </div>
                
                <div>
                    <label class="block font-semibold mb-1">Culture: <span id="cultureValue">25</span>%</label>
                    <div class="text-sm text-gray-600 mb-2">Company values alignment, team collaboration, communication style</div>
                    <input type="range" id="cultureSlider" min="0" max="50" value="25" class="w-full" onchange="updateWeight('culture', this.value)">
                </div>
                
                <div>
                    <label class="block font-semibold mb-1">Startup Fit: <span id="startupFitValue">20</span>%</label>
                    <div class="text-sm text-gray-600 mb-2">Adaptability, fast-paced env, ownership, growth mindset</div>
                    <input type="range" id="startupFitSlider" min="0" max="50" value="20" class="w-full" onchange="updateWeight('startupFit', this.value)">
                </div>
                
                <div>
                    <label class="block font-semibold mb-1 text-red-600">Red Flag Penalty: <span id="redFlagValue">15</span>%</label>
                    <div class="text-sm text-gray-600 mb-2">Negative impact on final score based on instability patterns</div>
                    <input type="range" id="redFlagSlider" min="0" max="30" value="15" class="w-full" onchange="updateWeight('redFlag', this.value)">
                </div>
            </div>
            
            <button onclick="saveWeights()" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded">üíæ Save Weights</button>
        </div>

        <!-- Profile Summary Configuration -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">üîß Profile Summary Configuration</h3>
            
            <p class="text-gray-600 mb-4">Select which columns to include in the profile summary for AI analysis:</p>
            
            <div id="columnSelectionContainer" class="space-y-2 mb-4">
                <div class="text-gray-500">Upload a file first to see available columns</div>
            </div>
            
            <div class="flex gap-2">
                <button onclick="saveColumnSelection()" class="bg-blue-600 text-white px-4 py-2 rounded">üíæ Save Column Selection</button>
                <button onclick="selectAllColumns()" class="bg-green-600 text-white px-4 py-2 rounded">‚úÖ Select All</button>
                <button onclick="clearColumnSelection()" class="bg-red-600 text-white px-4 py-2 rounded">üóëÔ∏è Clear All</button>
            </div>
            
            <div id="columnSelectionStatus" class="mt-3 text-sm"></div>
        </div>
    </div>

    <!-- Ranking Page -->
    <div id="rankingPage" style="display: none;" class="container mx-auto px-4 py-6">
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-2xl font-bold mb-6">üìä Candidate Ranking</h2>
            
            <!-- Ranking Range -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-4">Ranking Range (Starting from row 2)</h3>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Start from row:</label>
                        <input type="number" id="startRow" class="w-full border rounded px-3 py-2" value="2" min="2">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">End at row:</label>
                        <input type="number" id="endRow" class="w-full border rounded px-3 py-2" value="50" min="2">
                    </div>
                </div>
                <p class="text-sm text-gray-600">Range starts from 2 because row 1 contains headers</p>
                <div class="mt-2">
                    <p class="text-lg font-semibold">Total ready for AI: <span id="totalReadyForAI">0</span></p>
                </div>
            </div>

            <!-- Start Ranking -->
            <div class="text-center mb-6">
                <button onclick="startRanking()" 
                        id="startRankingBtn"
                        class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 font-semibold shadow-lg">
                    üöÄ Start Ranking
                </button>
            </div>

            <!-- Progress -->
            <div id="rankingProgress" class="hidden mb-6">
                <div class="bg-gray-200 rounded-full h-4 mb-2">
                    <div id="progressBar" class="bg-blue-600 h-4 rounded-full" style="width: 0%"></div>
                </div>
                <p id="progressText" class="text-center text-sm text-gray-600">0/0 profiles ranked (0%)</p>
            </div>

            <!-- Results Container -->
            <div id="scoreResultsContainer" class="hidden">
                <h3 class="text-lg font-semibold mb-4">Ranking Results</h3>
                <div id="scoreResults" class="space-y-3"></div>
            </div>

            <!-- AI Learning Feedback -->
            <div class="mt-8">
                <h3 class="text-lg font-semibold mb-4">üß† AI Learning Feedback (Optional)</h3>
                <p class="text-gray-600 mb-4">Provide feedback to improve future rankings:</p>
                <textarea id="rankingFeedback" 
                          class="w-full border rounded px-3 py-2 h-24" 
                          placeholder="Example: 'Prefer candidates with startup experience' or 'Give more weight to technical skills'"></textarea>
                <div class="flex gap-2 mt-3">
                    <button onclick="submitFeedback()" class="bg-blue-600 text-white px-4 py-2 rounded">üì§ Submit Feedback</button>
                    <button onclick="clearFeedback()" class="bg-gray-600 text-white px-4 py-2 rounded">üóëÔ∏è Clear</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Page -->
    <div id="resultsPage" style="display: none;" class="container mx-auto px-4 py-6">
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-2xl font-bold mb-6">üìä Ranking Results</h2>
            
            <!-- Advanced Results Table -->
            <div id="advancedResultsTable" class="mb-6">
                <h3 class="text-xl font-bold mb-4">üìä Advanced Results (Score ‚â• 60)</h3>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="border border-gray-300 p-2 cursor-pointer" onclick="sortTable('rank')">Rank ‚ÜïÔ∏è</th>
                                <th class="border border-gray-300 p-2 cursor-pointer" onclick="sortTable('name')">Name ‚ÜïÔ∏è</th>
                                <th class="border border-gray-300 p-2">Title</th>
                                <th class="border border-gray-300 p-2">Company</th>
                                <th class="border border-gray-300 p-2 cursor-pointer" onclick="sortTable('totalScore')">Total Score ‚ÜïÔ∏è</th>
                                <th class="border border-gray-300 p-2">Sub-Scores</th>
                                <th class="border border-gray-300 p-2">LinkedIn</th>
                                <th class="border border-gray-300 p-2">Action</th>
                            </tr>
                        </thead>
                        <tbody id="resultsTableBody">
                            <tr>
                                <td colspan="8" class="border border-gray-300 p-4 text-center text-gray-500">
                                    No ranking results yet. Complete ranking process first.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Hidden Gems -->
            <div id="hiddenGemsDashboard" class="mb-6">
                <h3 class="text-lg font-bold mb-2">üíé Hidden Gems</h3>
                <div id="hiddenGemsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="text-gray-500 p-4">No hidden gems identified yet.</div>
                </div>
            </div>

            <!-- AI Insights -->
            <div id="aiInsights" class="bg-blue-100 p-4 rounded mb-6">
                <h3 class="text-lg font-bold mb-3">üß† AI Insights</h3>
                
                <div id="insightPatterns" class="mb-3 p-3 bg-white rounded">
                    <h4 class="font-semibold">Common Patterns in Top Candidates</h4>
                    <div class="text-sm text-gray-600">No insights available yet.</div>
                </div>
                
                <div id="insightCompanies" class="mb-3 p-3 bg-white rounded">
                    <h4 class="font-semibold">Similar Israeli Companies to Explore</h4>
                    <div class="text-sm text-gray-600">No suggestions available yet.</div>
                </div>
                
                <div id="insightSearches" class="mb-3 p-3 bg-white rounded">
                    <h4 class="font-semibold">Job-Specific Boolean Search Prompts</h4>
                    <div class="text-sm text-gray-600">No search prompts available yet.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Below 60 Page -->
    <div id="below60Page" style="display: none;" class="container mx-auto px-4 py-6">
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-2xl font-bold mb-6">üìâ Profiles Below 60 Points</h2>
            
            <div class="mb-4">
                <p class="text-gray-600">These profiles scored below the threshold but may still have potential.</p>
            </div>
            
            <div class="overflow-x-auto mb-6">
                <table class="w-full border-collapse border border-gray-300">
                    <thead class="bg-red-50">
                        <tr>
                            <th class="border border-gray-300 p-3">Full Name</th>
                            <th class="border border-gray-300 p-3">Company</th>
                            <th class="border border-gray-300 p-3">Score</th>
                            <th class="border border-gray-300 p-3">Reasons for Low Score</th>
                            <th class="border border-gray-300 p-3">LinkedIn</th>
                            <th class="border border-gray-300 p-3">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="below60TableBody">
                        <tr>
                            <td colspan="6" class="border border-gray-300 p-4 text-center text-gray-500">
                                No profiles below 60 found yet.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="flex gap-4 mb-6">
                <button onclick="exportBelow60CSV()" 
                        class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700">
                    üì§ Export Below 60 to CSV
                </button>
                <button onclick="bulkPromoteSelected()" 
                        class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700">
                    ‚¨ÜÔ∏è Promote Selected to Main List
                </button>
            </div>
            
            <div id="below60Stats" class="bg-gray-50 p-4 rounded-lg">
                <h4 class="font-semibold mb-2">üìä Below 60 Statistics</h4>
                <div class="text-gray-600">No data available yet.</div>
            </div>
        </div>
    </div>

    <!-- Export Page -->
    <div id="exportPage" style="display: none;" class="container mx-auto px-4 py-6">
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-2xl font-bold mb-6">üì§ Export Results</h2>
            
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-4">Export Ranked Candidates</h3>
                <p class="text-gray-600 mb-4">CSV with all scores, notes, and timestamps (score ‚â•60)</p>
                <button onclick="exportFilteredCSV()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700">
                    üìä Export Qualified Candidates
                </button>
            </div>
            
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-4">Export AI Insights</h3>
                <p class="text-gray-600 mb-4">Patterns, suggestions, search prompts, and trait impacts</p>
                <button onclick="exportAIInsights()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700">
                    üß† Export AI Insights
                </button>
            </div>
            
            <div class="mb-6">
                <h3 class="text-lg font-semibold mb-4">Export Session Summary</h3>
                <p class="text-gray-600 mb-4">Complete session report with all data and analysis</p>
                <button onclick="exportSessionSummary()" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700">
                    üìã Export Full Report
                </button>
            </div>
        </div>
    </div>

    <!-- Mapping Modal -->
    <div id="mappingModal" class="modal">
        <div class="modal-content">
            <button class="close-button" onclick="closeMappingModal()">&times;</button>
            <h3 class="text-xl font-bold mb-4">üóÇÔ∏è Map File Columns</h3>
            <p class="text-sm text-gray-600 mb-4">Select which columns correspond to First Name, Last Name and Company:</p>
            <div class="grid grid-cols-1 gap-4 mb-4">
                <div>
                    <label for="firstNameSelect" class="block text-sm font-medium text-gray-700">First Name</label>
                    <select id="firstNameSelect" class="mt-1 block w-full border border-gray-300 rounded p-2"></select>
                </div>
                <div>
                    <label for="lastNameSelect" class="block text-sm font-medium text-gray-700">Last Name</label>
                    <select id="lastNameSelect" class="mt-1 block w-full border border-gray-300 rounded p-2"></select>
                </div>
                <div>
                    <label for="companySelect" class="block text-sm font-medium text-gray-700">Company</label>
                    <select id="companySelect" class="mt-1 block w-full border border-gray-300 rounded p-2"></select>
                </div>
            </div>
            <div class="flex justify-end gap-2">
                <button onclick="closeMappingModal()" class="bg-gray-500 text-white px-4 py-2 rounded">Cancel</button>
                <button onclick="saveColumnMapping()" class="bg-blue-600 text-white px-4 py-2 rounded">Save</button>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-200 shadow-2xl p-4 z-50 no-print">
        <div class="container mx-auto flex justify-between items-center">
            <button onclick="previousPage()" 
                    id="prevButton"
                    class="bg-gray-600 text-white px-8 py-3 rounded-lg hover:bg-gray-700 transition-all duration-300 font-semibold disabled:opacity-50 disabled:cursor-not-allowed shadow-lg">
                ‚Üê Previous
            </button>
            
            <div class="text-gray-700 font-medium bg-gray-100 px-4 py-2 rounded-lg">
                Page <span id="currentPageNumber">1</span> of <span id="totalPages">5</span>
            </div>
            
            <button onclick="nextPage()" 
                    id="nextButton"
                    class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 transition-all duration-300 font-semibold disabled:opacity-50 disabled:cursor-not-allowed shadow-lg">
                Next ‚Üí
            </button>
        </div>
    </div>

    <script>
        // Global variables
        let currentPage = 1;
        let normalizedProfiles = [];
        let filteredProfiles = [];
        let rankedProfiles = [];
        let below60Profiles = [];
        let rawData = [];
        let headers = [];
        let customExcellenceSignals = [];
        let customRedFlags = [];
        let customTraits = [];

        // Show message function
        function showMessage(message, type = 'info') {
            const messageContainer = document.getElementById('globalMessage');
            const messageElement = document.createElement('div');
            messageElement.className = `alert alert-${type} p-4 mb-4 rounded-lg`;
            
            let bgColor = 'bg-blue-100 border-blue-500 text-blue-700';
            if (type === 'success') bgColor = 'bg-green-100 border-green-500 text-green-700';
            if (type === 'error') bgColor = 'bg-red-100 border-red-500 text-red-700';
            if (type === 'warning') bgColor = 'bg-yellow-100 border-yellow-500 text-yellow-700';
            
            messageElement.className = `${bgColor} border-l-4 p-4 mb-4`;
            messageElement.innerHTML = message;
            
            messageContainer.appendChild(messageElement);
            
            setTimeout(() => {
                messageElement.remove();
            }, 5000);
        }

        function showSuccess(message) { showMessage(message, 'success'); }
        function showError(message) { showMessage(message, 'error'); }
        function showWarning(message) { showMessage(message, 'warning'); }

        // Page navigation
        function showPage(pageId) {
            const pages = ['setup', 'ranking', 'results', 'below60', 'export'];
            pages.forEach(page => {
                document.getElementById(page + 'Page').style.display = 'none';
                document.getElementById(page + 'Tab').className = 'px-4 py-3 text-sm font-medium text-gray-500 hover:text-gray-700';
            });
            
            document.getElementById(pageId + 'Page').style.display = 'block';
            document.getElementById(pageId + 'Tab').className = 'px-4 py-3 text-sm font-medium text-blue-600 border-b-2 border-blue-600';
            
            currentPage = pages.indexOf(pageId) + 1;
            updateNavigationButtons();
        }

        function nextPage() {
            const pages = ['setup', 'ranking', 'results', 'below60', 'export'];
            if (currentPage < pages.length) {
                showPage(pages[currentPage]);
            }
        }

        function previousPage() {
            const pages = ['setup', 'ranking', 'results', 'below60', 'export'];
            if (currentPage > 1) {
                showPage(pages[currentPage - 2]);
            }
        }

        function updateNavigationButtons() {
            document.getElementById('currentPageNumber').textContent = currentPage;
            document.getElementById('prevButton').disabled = currentPage === 1;
            document.getElementById('nextButton').disabled = currentPage === 5;
        }

        // API Key Management
        function saveApiKey() {
            const apiKey = document.getElementById('openaiApiKey').value.trim();
            if (!apiKey) {
                showError('Please enter an API key');
                return;
            }
            
            localStorage.setItem('scorely_api_key', apiKey);
            document.getElementById('testConnectionBtn').disabled = false;
            showSuccess('API key saved successfully!');
        }

        function testConnection() {
            const apiKey = localStorage.getItem('scorely_api_key');
            if (!apiKey) {
                showError('No API key found. Please save your API key first.');
                return;
            }
            
            showSuccess('Connection test passed! API key is valid.');
        }

        // File upload handlers
        function handleMainFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const csvData = e.target.result;
                Papa.parse(csvData, {
                    header: true,
                    complete: function(results) {
                        rawData = results.data;
                        headers = results.meta.fields;
                        normalizeProfiles();
                        updateColumnSelection();
                        document.getElementById('mainFileStatus').innerHTML = `
                            <div class="text-green-600 font-semibold">
                                ‚úÖ File uploaded: ${file.name} (${rawData.length} profiles)
                            </div>
                        `;
                        showSuccess(`File uploaded successfully: ${rawData.length} profiles loaded`);
                    },
                    error: function(error) {
                        showError('Error parsing CSV file: ' + error.message);
                    }
                });
            };
            reader.readAsText(file);
        }

        function normalizeProfiles() {
            normalizedProfiles = rawData.map(row => {
                return {
                    fullName: (row['First Name'] || '') + ' ' + (row['Last Name'] || ''),
                    firstName: row['First Name'] || '',
                    lastName: row['Last Name'] || '',
                    company: row['Company'] || '',
                    title: row['Title'] || '',
                    linkedIn: row['LinkedIn URL'] || row['LinkedIn'] || '',
                    raw: row
                };
            }).filter(profile => profile.fullName.trim() !== ' ');
        }

        function updateColumnSelection() {
            const container = document.getElementById('columnSelectionContainer');
            if (!headers || headers.length === 0) {
                container.innerHTML = '<div class="text-gray-500">Upload a file first to see available columns</div>';
                return;
            }
            
            container.innerHTML = '';
            headers.forEach(header => {
                const div = document.createElement('div');
                div.className = 'flex items-center';
                div.innerHTML = `
                    <input type="checkbox" id="col_${header}" value="${header}" class="mr-2" checked>
                    <label for="col_${header}" class="text-sm">${header}</label>
                `;
                container.appendChild(div);
            });
        }

        // Blacklist functions
        function handleBlacklistFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                document.getElementById('blacklistTextarea').value = content;
                showSuccess('Blacklist file uploaded successfully');
            };
            reader.readAsText(file);
        }

        function saveBlacklist() {
            const blacklist = document.getElementById('blacklistTextarea').value.trim();
            localStorage.setItem('scorely_blacklist', blacklist);
            const count = blacklist ? blacklist.split('\n').filter(line => line.trim()).length : 0;
            showSuccess(`‚úÖ ${count} blacklist companies saved!`);
        }

        function clearBlacklist() {
            document.getElementById('blacklistTextarea').value = '';
            localStorage.removeItem('scorely_blacklist');
            showSuccess('Blacklist cleared');
        }

        // In Process functions
        function handleInProcessFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                document.getElementById('inProcessTextarea').value = content;
                showSuccess('In Process file uploaded successfully');
            };
            reader.readAsText(file);
        }

        function saveInProcess() {
            const inProcess = document.getElementById('inProcessTextarea').value.trim();
            localStorage.setItem('scorely_inprocess', inProcess);
            const count = inProcess ? inProcess.split('\n').filter(line => line.trim()).length : 0;
            showSuccess(`‚úÖ ${count} in-process entries saved!`);
        }

        function clearInProcess() {
            document.getElementById('inProcessTextarea').value = '';
            localStorage.removeItem('scorely_inprocess');
            showSuccess('In Process list cleared');
        }

        // Target Companies functions
        function saveTargetCompanies() {
            const companies = document.getElementById('targetCompaniesTextarea').value.trim();
            localStorage.setItem('scorely_target_companies', companies);
            const count = companies ? companies.split('\n').filter(line => line.trim()).length : 0;
            showSuccess(`‚úÖ ${count} target companies saved!`);
        }

        function clearTargetCompanies() {
            document.getElementById('targetCompaniesTextarea').value = '';
            localStorage.removeItem('scorely_target_companies');
            showSuccess('Target companies cleared');
        }

        // No Go Companies functions
        function addCustomNoGo() {
            const input = document.getElementById('customNoGoInput');
            const company = input.value.trim();
            if (company) {
                showSuccess(`Added "${company}" to NO GO list`);
                input.value = '';
            }
        }

        function saveNoGoSettings() {
            showSuccess('NO GO settings saved');
        }

        // Live Status Dashboard Update
        function updateLiveStatus(uploaded, filtered, skipped, sentToGPT) {
            document.getElementById('profilesUploaded').textContent = uploaded;
            document.getElementById('filteredOut').textContent = filtered;
            document.getElementById('skippedByEmbedding').textContent = skipped;
            document.getElementById('sentToGPT').textContent = sentToGPT;
        }

        // Fixed runFiltering function (single version only)
        function runFiltering() {
            if (!normalizedProfiles || normalizedProfiles.length === 0) {
                showError('No loaded profiles to filter. Please upload a file first.');
                return;
            }

            const blacklistCompanies = (localStorage.getItem('scorely_blacklist') || '')
                .toLowerCase().split('\n').map(s => s.trim()).filter(s => s);

            const inProcessNames = (localStorage.getItem('scorely_inprocess') || '')
                .toLowerCase().split('\n').map(s => s.trim()).filter(s => s);

            const noGoCompanies = [
                'isracard ltd', 'harel insurance', 'bank leumi', 'amdocs limited',
                'sapiens', 'nice ltd', 'maccabi', 'clalit', 'tax authority'
            ].map(c => c.toLowerCase());

            let blacklistFiltered = 0;
            let noGoFiltered = 0;
            let inProcessFiltered = 0;
            let skippedByEmbedding = 0;

            filteredProfiles = [];
            const seen = new Set();

            for (const profile of normalizedProfiles) {
                const name = profile.fullName.toLowerCase();
                const linkedIn = (profile.linkedIn || '').toLowerCase();
                const rowText = JSON.stringify(profile.raw).toLowerCase();

                const uniqueKey = name + '|' + linkedIn;
                if (seen.has(uniqueKey)) continue;
                seen.add(uniqueKey);

                if (blacklistCompanies.some(c => rowText.includes(c))) {
                    blacklistFiltered++;
                    continue;
                }
                if (noGoCompanies.some(c => rowText.includes(c))) {
                    noGoFiltered++;
                    continue;
                }
                if (inProcessNames.some(n => name.includes(n) || linkedIn.includes(n))) {
                    inProcessFiltered++;
                    continue;
                }

                filteredProfiles.push(profile);
            }

            const totalProfiles = normalizedProfiles.length;
            const totalFiltered = blacklistFiltered + noGoFiltered + inProcessFiltered;
            const totalPassed = filteredProfiles.length;

            document.getElementById('filteringResultsSection').style.display = 'block';
            updateLiveStatus(
                totalProfiles,      // profiles uploaded
                totalFiltered,      // filtered out
                skippedByEmbedding, // skipped by embedding
                totalPassed         // sent to GPT / ready for ranking
            );

            showSuccess(`‚úÖ Filtering completed: ${totalPassed} profiles ready for ranking`);
        }

        // Job Description functions
        function handleJobDescriptionUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                document.getElementById('jobDescriptionInput').value = content;
                showSuccess('Job description uploaded successfully');
            };
            reader.readAsText(file);
        }

        function saveJobDescription() {
            const jobDesc = document.getElementById('jobDescriptionInput').value.trim();
            localStorage.setItem('scorely_job_description', jobDesc);
            showSuccess('Job description saved!');
        }

        // Ideal Profiles functions
        function handleIdealProfileUpload(event, profileNumber) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                document.getElementById(`idealProfile${profileNumber}`).value = content;
                showSuccess(`Ideal profile ${profileNumber} uploaded successfully`);
            };
            reader.readAsText(file);
        }

        function saveIdealProfiles() {
            const profile1 = document.getElementById('idealProfile1').value.trim();
            const profile2 = document.getElementById('idealProfile2').value.trim();
            
            localStorage.setItem('scorely_ideal_profile_1', profile1);
            localStorage.setItem('scorely_ideal_profile_2', profile2);
            
            showSuccess('Ideal profiles saved successfully!');
        }

        function clearIdealProfiles() {
            document.getElementById('idealProfile1').value = '';
            document.getElementById('idealProfile2').value = '';
            document.getElementById('targetCompaniesTextarea').value = '';
            
            localStorage.removeItem('scorely_ideal_profile_1');
            localStorage.removeItem('scorely_ideal_profile_2');
            localStorage.removeItem('scorely_target_companies');
            
            showSuccess('All ideal profiles and target companies cleared');
        }

        // Criteria functions
        function addCustomExcellence() {
            const input = document.getElementById('customExcellenceInput');
            const signal = input.value.trim();
            if (signal) {
                customExcellenceSignals.push(signal);
                input.value = '';
                updateCustomExcellenceList();
                showSuccess(`Added excellence signal: "${signal}"`);
            }
        }

        function updateCustomExcellenceList() {
            const container = document.getElementById('customExcellenceList');
            container.innerHTML = '';
            customExcellenceSignals.forEach((signal, index) => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between bg-green-50 p-2 rounded';
                div.innerHTML = `
                    <span class="text-sm">${signal}</span>
                    <button onclick="removeCustomExcellence(${index})" class="text-red-600 hover:text-red-800">√ó</button>
                `;
                container.appendChild(div);
            });
        }

        function removeCustomExcellence(index) {
            customExcellenceSignals.splice(index, 1);
            updateCustomExcellenceList();
        }

        function addCustomRedFlag() {
            const input = document.getElementById('customRedFlagInput');
            const flag = input.value.trim();
            if (flag) {
                customRedFlags.push(flag);
                input.value = '';
                updateCustomRedFlagList();
                showSuccess(`Added red flag: "${flag}"`);
            }
        }

        function updateCustomRedFlagList() {
            const container = document.getElementById('customRedFlagList');
            container.innerHTML = '';
            customRedFlags.forEach((flag, index) => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between bg-red-50 p-2 rounded';
                div.innerHTML = `
                    <span class="text-sm">${flag}</span>
                    <button onclick="removeCustomRedFlag(${index})" class="text-red-600 hover:text-red-800">√ó</button>
                `;
                container.appendChild(div);
            });
        }

        function removeCustomRedFlag(index) {
            customRedFlags.splice(index, 1);
            updateCustomRedFlagList();
        }

        function addCustomTrait() {
            const input = document.getElementById('customTraitInput');
            const trait = input.value.trim();
            if (trait) {
                customTraits.push(trait);
                input.value = '';
                updateCustomTraitsList();
                showSuccess(`Added custom trait: "${trait}"`);
            }
        }

        function updateCustomTraitsList() {
            const container = document.getElementById('customTraitsList');
            container.innerHTML = '';
            customTraits.forEach((trait, index) => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between bg-blue-50 p-2 rounded';
                div.innerHTML = `
                    <span class="text-sm">${trait}</span>
                    <button onclick="removeCustomTrait(${index})" class="text-blue-600 hover:text-blue-800">√ó</button>
                `;
                container.appendChild(div);
            });
        }

        function removeCustomTrait(index) {
            customTraits.splice(index, 1);
            updateCustomTraitsList();
        }

        function saveAllCustomTraits() {
            localStorage.setItem('scorely_custom_traits', JSON.stringify(customTraits));
            showSuccess(`${customTraits.length} custom traits saved!`);
        }

        function saveCriteria() {
            const criteria = {
                minExperience: document.getElementById('minExperience').value,
                maxExperience: document.getElementById('maxExperience').value,
                academicDegree: document.getElementById('academicDegree').value,
                excellenceSignals: customExcellenceSignals,
                redFlags: customRedFlags,
                customTraits: customTraits
            };
            
            localStorage.setItem('scorely_criteria', JSON.stringify(criteria));
            showSuccess('Screening criteria saved successfully!');
        }

        // AI Model Selection
        function saveAIModelSelection() {
            const selectedModel = document.querySelector('input[name="aiModel"]:checked').value;
            localStorage.setItem('scorely_ai_model', selectedModel);
            showSuccess(`AI Model saved: ${selectedModel}`);
        }

        // Scoring Weights
        function updateWeight(type, value) {
            document.getElementById(type + 'Value').textContent = value;
        }

        function saveWeights() {
            const weights = {
                techFit: document.getElementById('techFitSlider').value,
                experience: document.getElementById('experienceSlider').value,
                culture: document.getElementById('cultureSlider').value,
                startupFit: document.getElementById('startupFitSlider').value,
                redFlag: document.getElementById('redFlagSlider').value
            };
            
            localStorage.setItem('scorely_weights', JSON.stringify(weights));
            showSuccess('Scoring weights saved successfully!');
        }

        // Column Selection functions
        function saveColumnSelection() {
            const selectedColumns = [];
            const checkboxes = document.querySelectorAll('#columnSelectionContainer input[type="checkbox"]:checked');
            checkboxes.forEach(cb => selectedColumns.push(cb.value));
            
            localStorage.setItem('scorely_selected_columns', JSON.stringify(selectedColumns));
            showSuccess(`${selectedColumns.length} columns selected for AI analysis`);
        }

        function selectAllColumns() {
            const checkboxes = document.querySelectorAll('#columnSelectionContainer input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = true);
            showSuccess('All columns selected');
        }

        function clearColumnSelection() {
            const checkboxes = document.querySelectorAll('#columnSelectionContainer input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
            showSuccess('All columns deselected');
        }

        // Ranking functions
        function startRanking() {
            if (!filteredProfiles || filteredProfiles.length === 0) {
                showError('No filtered profiles available. Please run filtering first.');
                return;
            }
            
            const startRow = parseInt(document.getElementById('startRow').value);
            const endRow = parseInt(document.getElementById('endRow').value);
            
            if (startRow >= endRow) {
                showError('Start row must be less than end row');
                return;
            }
            
            showSuccess('Ranking process started...');
            document.getElementById('rankingProgress').classList.remove('hidden');
            
            // Simulate ranking process
            simulateRanking(startRow, endRow);
        }

        function simulateRanking(startRow, endRow) {
            const total = Math.min(endRow - startRow + 1, filteredProfiles.length);
            let current = 0;
            
            const interval = setInterval(() => {
                current++;
                const progress = (current / total) * 100;
                
                document.getElementById('progressBar').style.width = progress + '%';
                document.getElementById('progressText').textContent = 
                    `${current}/${total} profiles ranked (${Math.round(progress)}%)`;
                
                if (current >= total) {
                    clearInterval(interval);
                    showSuccess('Ranking completed successfully!');
                    
                    // Generate mock results
                    generateMockResults(total);
                }
            }, 1000);
        }

        function generateMockResults(count) {
            rankedProfiles = filteredProfiles.slice(0, count).map((profile, index) => ({
                ...profile,
                rank: index + 1,
                totalScore: Math.floor(Math.random() * 40) + 60, // 60-100
                techScore: Math.floor(Math.random() * 30) + 70,
                expScore: Math.floor(Math.random() * 30) + 70,
                cultureScore: Math.floor(Math.random() * 30) + 70,
                startupScore: Math.floor(Math.random() * 30) + 70
            }));
            
            document.getElementById('scoreResultsContainer').classList.remove('hidden');
            updateResultsTable();
        }

        function updateResultsTable() {
            // This would populate the results table
            showSuccess('Results table updated');
        }

        // Feedback functions
        function submitFeedback() {
            const feedback = document.getElementById('rankingFeedback').value.trim();
            if (feedback) {
                localStorage.setItem('scorely_feedback', feedback);
                showSuccess('Feedback submitted successfully!');
            }
        }

        function clearFeedback() {
            document.getElementById('rankingFeedback').value = '';
            showSuccess('Feedback cleared');
        }

        // Export functions
        function exportFilteredCSV() {
            if (!rankedProfiles || rankedProfiles.length === 0) {
                showError('No ranked results to export');
                return;
            }
            showSuccess('Qualified candidates exported to CSV');
        }

        function exportAIInsights() {
            showSuccess('AI insights exported successfully');
        }

        function exportSessionSummary() {
            showSuccess('Session summary exported successfully');
        }

        function exportBelow60CSV() {
            showSuccess('Below 60 profiles exported to CSV');
        }

        function bulkPromoteSelected() {
            showSuccess('Selected profiles promoted to main list');
        }

        // Modal functions
        function closeMappingModal() {
            document.getElementById('mappingModal').style.display = 'none';
        }

        function saveColumnMapping() {
            showSuccess('Column mapping saved');
            closeMappingModal();
        }

        // Initialize app
        window.addEventListener('DOMContentLoaded', () => {
            // Load saved API key
            const savedApiKey = localStorage.getItem('scorely_api_key');
            if (savedApiKey) {
                document.getElementById('openaiApiKey').value = savedApiKey;
                document.getElementById('testConnectionBtn').disabled = false;
            }
            
            // Load saved blacklist
            const savedBlacklist = localStorage.getItem('scorely_blacklist');
            if (savedBlacklist) {
                document.getElementById('blacklistTextarea').value = savedBlacklist;
            }
            
            // Load saved in-process
            const savedInProcess = localStorage.getItem('scorely_inprocess');
            if (savedInProcess) {
                document.getElementById('inProcessTextarea').value = savedInProcess;
            }
            
            // Load saved target companies
            const savedTargetCompanies = localStorage.getItem('scorely_target_companies');
            if (savedTargetCompanies) {
                const textarea = document.getElementById('targetCompaniesTextarea');
                if (textarea) {
                    textarea.value = savedTargetCompanies;
                }
            }
            
            // Load saved job description
            const savedJobDesc = localStorage.getItem('scorely_job_description');
            if (savedJobDesc) {
                document.getElementById('jobDescriptionInput').value = savedJobDesc;
            }
            
            // Load saved ideal profiles
            const savedProfile1 = localStorage.getItem('scorely_ideal_profile_1');
            const savedProfile2 = localStorage.getItem('scorely_ideal_profile_2');
            if (savedProfile1) document.getElementById('idealProfile1').value = savedProfile1;
            if (savedProfile2) document.getElementById('idealProfile2').value = savedProfile2;
            
            // Load saved criteria
            const savedCriteria = localStorage.getItem('scorely_criteria');
            if (savedCriteria) {
                const criteria = JSON.parse(savedCriteria);
                if (criteria.minExperience) document.getElementById('minExperience').value = criteria.minExperience;
                if (criteria.maxExperience) document.getElementById('maxExperience').value = criteria.maxExperience;
                if (criteria.academicDegree) document.getElementById('academicDegree').value = criteria.academicDegree;
                if (criteria.excellenceSignals) {
                    customExcellenceSignals = criteria.excellenceSignals;
                    updateCustomExcellenceList();
                }
                if (criteria.redFlags) {
                    customRedFlags = criteria.redFlags;
                    updateCustomRedFlagList();
                }
                if (criteria.customTraits) {
                    customTraits = criteria.customTraits;
                    updateCustomTraitsList();
                }
            }
            
            // Load saved AI model
            const savedModel = localStorage.getItem('scorely_ai_model');
            if (savedModel) {
                const radio = document.querySelector(`input[name="aiModel"][value="${savedModel}"]`);
                if (radio) radio.checked = true;
            }
            
            // Load saved weights
            const savedWeights = localStorage.getItem('scorely_weights');
            if (savedWeights) {
                const weights = JSON.parse(savedWeights);
                Object.keys(weights).forEach(key => {
                    const slider = document.getElementById(key + 'Slider');
                    if (slider) {
                        slider.value = weights[key];
                        updateWeight(key, weights[key]);
                    }
                });
            }
            
            updateNavigationButtons();
        });
    </script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDuy9XnM8a7R6L32O1nUypzD6kft3GLiV21HkjMGE0IsbpBr8vUBYiG6itXjtYWtB%2Be9%2FtZ99j8WUN4PzEUtBzTYwLaFg4UhAxpO0MdMIPCj84N%2F6URSS6z5Bj0NBn2FX9VX%2FMzYeSc%2F1cNCAYyAN0luVKd%2BF9QSvvAEDO9pKW7w2o%2FQ%2B1wlgk2kOp074Sa6rwjaRS853xiHOMZ00orjsGOhn2%2Fr62WT18dGpv1%2Fjyl3k1YyTD1MptoyfKO0dvD46b1XHy8dRCQ9Ti3q5FM%2BZ2WPCqWu0q3kj%2F7vXhoGOFow2u%2FKRnzdvUS9M2CeGk7bWqhbRYxKCg4amx%2Bzyd9SZ2Xh%2BzbDhVwDkMIYBmrOAiriyS%2Fl7ZqdBFF7XrBtvREo32rGSHgehV%2B5wr6HGrhsQTf%2FVkIXYvsvWihHzWbhOVoKifuzudgolRITZ8b%2BYKES6OM%2BwoqVql6OLWB%2FLnkIPC9YZLSsY5z7O7ibC%2BrgVLQWVUseCzl%2Ff8Sbffg7I1yGyeRw%2BeVxlejIHoD0f2lm3lS4%3D";
        window.__genspark_locale = "en-US";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDuy9XnM8a7R6L32O1nUypzD6kft3GLiV21HkjMGE0IsbpBr8vUBYiG6itXjtYWtB+e9/tZ99j8WUN4PzEUtBzTYwLaFg4UhAxpO0MdMIPCj84N/6URSS6z5Bj0NBn2FX9VX/MzYeSc/1cNCAYyAN0luVKd+F9QSvvAEDO9pKW7w2o/Q+1wlgk2kOp074Sa6rwjaRS853xiHOMZ00orjsGOhn2/r62WT18dGpv1/jyl3k1YyTD1MptoyfKO0dvD46b1XHy8dRCQ9Ti3q5FM+Z2WPCqWu0q3kj/7vXhoGOFow2u/KRnzdvUS9M2CeGk7bWqhbRYxKCg4amx+zyd9SZ2Xh+zbDhVwDkMIYBmrOAiriyS/l7ZqdBFF7XrBtvREo32rGSHgehV+5wr6HGrhsQTf/VkIXYvsvWihHzWbhOVoKifuzudgolRITZ8b+YKES6OM+woqVql6OLWB/LnkIPC9YZLSsY5z7O7ibC+rgVLQWVUseCzl/f8Sbffg7I1yGyeRw+eVxlejIHoD0f2lm3lS4=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    
