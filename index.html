<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scorely - AI-Powered Candidate Scoring</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            min-height: 100vh;
        }
        
        .sidebar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .nav-item {
            transition: all 0.3s ease;
            border-radius: 12px;
            margin: 4px 0;
        }
        
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(4px);
        }
        
        .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 4px solid #60A5FA;
        }
        
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            backdrop-filter: blur(10px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .upload-area {
            border: 2px dashed #CBD5E1;
            border-radius: 16px;
            background: rgba(248, 250, 252, 0.8);
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: #3B82F6;
            background: rgba(219, 234, 254, 0.5);
        }
        
        .upload-area.dragover {
            border-color: #1D4ED8;
            background: rgba(191, 219, 254, 0.8);
            transform: scale(1.02);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2563EB 0%, #1E40AF 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.6);
        }
        
        .btn-secondary {
            background: rgba(107, 114, 128, 0.1);
            border: 2px solid rgba(107, 114, 128, 0.3);
            color: #374151;
            border-radius: 12px;
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: rgba(107, 114, 128, 0.2);
            border-color: rgba(107, 114, 128, 0.5);
        }
        
        .score-badge {
            border-radius: 20px;
            padding: 6px 16px;
            font-weight: 700;
            font-size: 14px;
        }
        
        .score-top { background: #10B981; color: white; }
        .score-good { background: #3B82F6; color: white; }
        .score-average { background: #F59E0B; color: white; }
        
        .category-badge {
            border-radius: 16px;
            padding: 4px 12px;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
        }
        
        .category-top { background: #D1FAE5; color: #065F46; }
        .category-good { background: #DBEAFE; color: #1E40AF; }
        .category-average { background: #FEF3C7; color: #92400E; }
        
        .criteria-item {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
            border: 2px solid #E5E7EB;
            transition: all 0.3s ease;
        }
        
        .criteria-item:hover {
            border-color: #3B82F6;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }
        
        .candidate-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin: 16px 0;
            border-left: 5px solid #3B82F6;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .candidate-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        
        .progress-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(#3B82F6 0deg, #E5E7EB 0deg);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .progress-circle::before {
            content: '';
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            position: absolute;
        }
        
        .progress-text {
            position: relative;
            z-index: 10;
            font-weight: 700;
            font-size: 18px;
            color: #1F2937;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message {
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            font-weight: 600;
        }
        
        .message.success {
            background: #D1FAE5;
            color: #065F46;
            border-left: 4px solid #10B981;
        }
        
        .message.error {
            background: #FEE2E2;
            color: #991B1B;
            border-left: 4px solid #EF4444;
        }
        
        .message.info {
            background: #DBEAFE;
            color: #1E40AF;
            border-left: 4px solid #3B82F6;
        }
        
        .hidden { display: none !important; }
        
        .linkedin-btn {
            background: #0077B5;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .linkedin-btn:hover {
            background: #005885;
            transform: translateY(-2px);
        }
        
        .candidate-card-row {
            background: #F9FAFB;
        }
        
        .candidate-card-row td {
            padding: 24px !important;
        }
        
        .copy-btn {
            background: #10B981;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .copy-btn:hover {
            background: #059669;
            transform: translateY(-2px);
        }
        
        .guide-section {
            background: #F3F4F6;
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            border-left: 4px solid #3B82F6;
        }
        
        .example-box {
            background: #EFF6FF;
            border-radius: 8px;
            padding: 16px;
            margin: 12px 0;
            border: 1px solid #BFDBFE;
        }
        
        .feedback-guide {
            background: #F0F9FF;
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            border-left: 4px solid #0EA5E9;
        }
    </style>
</head>
<body>
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <div class="sidebar w-64 p-6 text-white">
            <div class="flex items-center mb-8">
                <div class="w-10 h-10 bg-white rounded-xl flex items-center justify-center mr-3">
                    <i class="fas fa-chart-line text-blue-600 text-xl"></i>
                </div>
                <h1 class="text-2xl font-bold">Scorely</h1>
            </div>
            
            <nav class="space-y-2">
                <a href="#" class="nav-item active flex items-center p-3 rounded-xl text-white" onclick="showTab('upload')" id="nav-upload">
                    <i class="fas fa-upload mr-3"></i>
                    Upload Data
                </a>
                <a href="#" class="nav-item flex items-center p-3 rounded-xl text-white" onclick="showTab('configure')" id="nav-configure">
                    <i class="fas fa-cog mr-3"></i>
                    Configure
                </a>
                <a href="#" class="nav-item flex items-center p-3 rounded-xl text-white" onclick="showTab('scoring')" id="nav-scoring">
                    <i class="fas fa-brain mr-3"></i>
                    AI Scoring
                </a>
                <a href="#" class="nav-item flex items-center p-3 rounded-xl text-white" onclick="showTab('results')" id="nav-results">
                    <i class="fas fa-chart-bar mr-3"></i>
                    Results
                </a>
                <a href="#" class="nav-item flex items-center p-3 rounded-xl text-white" onclick="showTab('smart-ai')" id="nav-smart-ai">
                    <i class="fas fa-lightbulb mr-3"></i>
                    Smart AI Engine
                </a>
                <a href="#" class="nav-item flex items-center p-3 rounded-xl text-white" onclick="showTab('export')" id="nav-export">
                    <i class="fas fa-download mr-3"></i>
                    Export
                </a>
            </nav>
            
            <div class="mt-8 space-y-3">
                <button class="btn-primary w-full flex items-center justify-center" onclick="startGuide()">
                    <i class="fas fa-book-open mr-2"></i>
                    Guide
                </button>
                <button class="btn-secondary w-full flex items-center justify-center" onclick="resetAllData()">
                    <i class="fas fa-redo mr-2"></i>
                    Reset
                </button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="flex-1 p-8">
            <div class="main-content max-w-6xl mx-auto p-8">
                
                <!-- Upload Tab -->
                <div id="upload-tab" class="tab-content active">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-upload mr-4 text-blue-600"></i>
                            Upload Candidate Data
                        </h2>
                        <p class="text-gray-600">Upload your candidate profiles to begin AI-powered scoring</p>
                    </div>
                    
                    <!-- API Key Setup -->
                    <div class="mb-8 p-6 bg-blue-50 rounded-xl border border-blue-200">
                        <h3 class="text-xl font-bold text-blue-800 mb-4 flex items-center">
                            <i class="fas fa-key mr-3"></i>
                            OpenAI API Key Setup
                        </h3>
                        <div class="flex space-x-4">
                            <input type="password" id="apiKeyInput" placeholder="sk-..." 
                                   class="flex-1 p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <button onclick="saveApiKey()" class="btn-primary">
                                <i class="fas fa-save mr-2"></i>
                                Save & Test
                            </button>
                        </div>
                        <div id="apiKeyStatus" class="mt-3"></div>
                    </div>
                    
                    <!-- File Upload -->
                    <div class="upload-area p-12 text-center" id="uploadArea">
                        <div class="mb-6">
                            <i class="fas fa-cloud-upload-alt text-6xl text-gray-400 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-700 mb-2">Drag & drop your file here</h3>
                            <p class="text-gray-500">Supports CSV and Excel files (.csv, .xlsx)</p>
                        </div>
                        <button class="btn-primary" id="browseBtn">
                            <i class="fas fa-folder-open mr-2"></i>
                            Browse Files
                        </button>
                        <input type="file" id="fileUpload" accept=".csv,.xlsx,.xls" class="hidden">
                    </div>
                    
                    <div id="uploadPreview" class="mt-6"></div>
                    <div id="messageArea"></div>
                </div>
                
                <!-- Configure Tab -->
                <div id="configure-tab" class="tab-content">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-cog mr-4 text-blue-600"></i>
                            Configure Scoring Parameters
                        </h2>
                        <p class="text-gray-600">Set up your job requirements and scoring criteria</p>
                    </div>
                    
                    <!-- Job Description -->
                    <div class="mb-8 p-6 bg-white rounded-xl border border-gray-200">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-briefcase mr-3 text-blue-600"></i>
                            Job Description
                        </h3>
                        <textarea id="jobDescription" rows="6" placeholder="Enter the job description, requirements, and expectations..."
                                  class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                        <button onclick="saveJobDescription()" class="btn-primary mt-4">
                            <i class="fas fa-save mr-2"></i>
                            Save Description
                        </button>
                    </div>
                    
                    <!-- Similar Profiles -->
                    <div class="mb-8 p-6 bg-white rounded-xl border border-gray-200">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-user-friends mr-3 text-green-600"></i>
                            Similar Profiles
                        </h3>
                        
                        <div class="guide-section">
                            <h4 class="font-bold text-gray-800 mb-3 flex items-center">
                                <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>
                                How to Add Similar Profiles:
                            </h4>
                            <ul class="space-y-2 text-gray-700 mb-4">
                                <li><strong>• Copy with Ctrl+A:</strong> Go to LinkedIn profile, press Ctrl+A to select all, then Ctrl+C to copy</li>
                                <li><strong>• Upload PDF/Word:</strong> Upload candidate CV files in PDF or Word format</li>
                                <li><strong>• Paste text:</strong> Copy profile information and paste directly into the text area</li>
                            </ul>
                        </div>
                        
                        <div class="flex space-x-4 mb-4">
                            <button onclick="document.getElementById('profileFileUpload').click()" class="btn-secondary">
                                <i class="fas fa-file-pdf mr-2"></i>
                                Upload PDF/Word
                            </button>
                            <button onclick="focusProfileTextarea()" class="btn-secondary">
                                <i class="fas fa-paste mr-2"></i>
                                Paste Text
                            </button>
                        </div>
                        
                        <input type="file" id="profileFileUpload" accept=".pdf,.doc,.docx" class="hidden">
                        <textarea id="similarProfiles" rows="8" placeholder="Paste profile information here (Name, Role, Company, Experience, Skills)..."
                                  class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4"></textarea>
                        
                        <div class="flex space-x-4">
                            <button onclick="saveSimilarProfile()" class="btn-primary">
                                <i class="fas fa-save mr-2"></i>
                                Save Profile
                            </button>
                            <button onclick="addAnotherProfile()" class="btn-secondary">
                                <i class="fas fa-plus mr-2"></i>
                                Add Another
                            </button>
                        </div>
                        
                        <div id="savedProfiles" class="mt-4"></div>
                    </div>
                    
                    <!-- Built-in Criteria -->
                    <div class="mb-8 p-6 bg-white rounded-xl border border-gray-200">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-list-check mr-3 text-purple-600"></i>
                            Built-in Criteria (Select all that apply)
                        </h3>
                        <p class="text-gray-600 mb-6">Configure the importance of each built-in criterion for this specific role</p>
                        
                        <div id="builtInCriteria">
                            <!-- Problematic Companies -->
                            <div class="criteria-item">
                                <h4 class="text-lg font-bold text-gray-800 mb-2 flex items-center">
                                    <i class="fas fa-ban mr-3 text-red-500"></i>
                                    Problematic Companies (AVOID)
                                </h4>
                                <p class="text-gray-600 mb-4">Experience at outsourcing companies and low-quality organizations we want to avoid</p>
                                <p class="text-sm text-gray-500 mb-4">
                                    <strong>Companies:</strong> Matrix, Ness, Taldor, Aman, Qualitest, Amdocs, Comverse, Magic Software, 
                                    Bynet, Max, Isracard, Zap, Log-on, Sapiens, Formula Systems, NICE Systems, AudioCodes, Allot, Radware, 
                                    Check Point (outsourcing divisions), Elbit Systems (non-defense), Gilat Satellite, NDS, Orckit, Scopus, 
                                    Babylon, Conduit, Pontis, StartApp, Mobixell, foreign outsourcing companies, consulting firms with no product development
                                </p>
                                <select class="weight-selector w-full p-3 border border-gray-300 rounded-xl">
                                    <option value="must-avoid">Must Avoid</option>
                                    <option value="minor-penalty">Minor Penalty</option>
                                    <option value="ignore">Ignore</option>
                                </select>
                            </div>
                            
                            <!-- Military Elite Units -->
                            <div class="criteria-item">
                                <h4 class="text-lg font-bold text-gray-800 mb-2 flex items-center">
                                    <i class="fas fa-medal mr-3 text-yellow-500"></i>
                                    Military Elite Units (PREFER)
                                </h4>
                                <p class="text-gray-600 mb-4">Background from Mamram, Havatzalot, Unit 81/49, 8200 - Strong preference for military tech background</p>
                                <select class="weight-selector w-full p-3 border border-gray-300 rounded-xl">
                                    <option value="must-have">Must Have</option>
                                    <option value="nice-to-have" selected>Nice to Have</option>
                                    <option value="not-important">Not Important</option>
                                </select>
                            </div>
                            
                            <!-- Startup Experience -->
                            <div class="criteria-item">
                                <h4 class="text-lg font-bold text-gray-800 mb-2 flex items-center">
                                    <i class="fas fa-rocket mr-3 text-blue-500"></i>
                                    Startup Experience (PREFER)
                                </h4>
                                <p class="text-gray-600 mb-4">Experience in startups or scale-up environments - We prefer candidates with startup experience</p>
                                <select class="weight-selector w-full p-3 border border-gray-300 rounded-xl">
                                    <option value="must-have">Must Have</option>
                                    <option value="nice-to-have" selected>Nice to Have</option>
                                    <option value="not-important">Not Important</option>
                                </select>
                            </div>
                            
                            <!-- Geographic Location -->
                            <div class="criteria-item">
                                <h4 class="text-lg font-bold text-gray-800 mb-2 flex items-center">
                                    <i class="fas fa-map-marker-alt mr-3 text-green-500"></i>
                                    Geographic Location (AVOID Remote Areas)
                                </h4>
                                <p class="text-gray-600 mb-4">Candidates from North/South/Haifa/Jerusalem - We prefer Tel Aviv/Center location</p>
                                <select class="weight-selector w-full p-3 border border-gray-300 rounded-xl">
                                    <option value="must-avoid">Must Avoid</option>
                                    <option value="minor-penalty" selected>Minor Penalty</option>
                                    <option value="ignore">Location Not Important</option>
                                </select>
                            </div>
                            
                            <!-- Current Freelancers -->
                            <div class="criteria-item">
                                <h4 class="text-lg font-bold text-gray-800 mb-2 flex items-center">
                                    <i class="fas fa-user-tie mr-3 text-orange-500"></i>
                                    Current Freelancers (AVOID)
                                </h4>
                                <p class="text-gray-600 mb-4">Currently freelance/consultant - We prefer employed candidates over freelancers</p>
                                <select class="weight-selector w-full p-3 border border-gray-300 rounded-xl">
                                    <option value="must-avoid">Must Avoid</option>
                                    <option value="minor-penalty" selected>Minor Penalty</option>
                                    <option value="ignore">Employment Status Not Important</option>
                                </select>
                            </div>
                            
                            <!-- Enterprise Only Background -->
                            <div class="criteria-item">
                                <h4 class="text-lg font-bold text-gray-800 mb-2 flex items-center">
                                    <i class="fas fa-building mr-3 text-indigo-500"></i>
                                    Enterprise Only Background (AVOID)
                                </h4>
                                <p class="text-gray-600 mb-4">Only large corporation experience - We prefer candidates with diverse experience</p>
                                <select class="weight-selector w-full p-3 border border-gray-300 rounded-xl">
                                    <option value="must-avoid">Must Avoid</option>
                                    <option value="minor-penalty" selected>Minor Penalty</option>
                                    <option value="ignore">Background Not Important</option>
                                </select>
                            </div>
                            
                            <!-- Optimal Job Tenure -->
                            <div class="criteria-item">
                                <h4 class="text-lg font-bold text-gray-800 mb-2 flex items-center">
                                    <i class="fas fa-clock mr-3 text-teal-500"></i>
                                    Optimal Job Tenure (PREFER)
                                </h4>
                                <p class="text-gray-600 mb-4">3-8 years in current role shows stability - We prefer candidates with stable tenure</p>
                                <select class="weight-selector w-full p-3 border border-gray-300 rounded-xl">
                                    <option value="must-have">Must Have</option>
                                    <option value="nice-to-have" selected>Nice to Have</option>
                                    <option value="not-important">Tenure Not Important</option>
                                </select>
                            </div>
                            
                            <!-- Academic Background -->
                            <div class="criteria-item">
                                <h4 class="text-lg font-bold text-gray-800 mb-2 flex items-center">
                                    <i class="fas fa-graduation-cap mr-3 text-pink-500"></i>
                                    Academic Background (PREFER)
                                </h4>
                                <p class="text-gray-600 mb-4">University degree from quality institutions - We prefer strong academic background</p>
                                <select class="weight-selector w-full p-3 border border-gray-300 rounded-xl">
                                    <option value="must-have">Must Have</option>
                                    <option value="nice-to-have" selected>Nice to Have</option>
                                    <option value="not-important">Education Not Important</option>
                                </select>
                            </div>
                            
                            <!-- Relevant Industry -->
                            <div class="criteria-item">
                                <h4 class="text-lg font-bold text-gray-800 mb-2 flex items-center">
                                    <i class="fas fa-industry mr-3 text-gray-600"></i>
                                    Relevant Industry (PREFER)
                                </h4>
                                <p class="text-gray-600 mb-4">SaaS, Fintech, Cyber, AI, Automotive experience - We prefer relevant industry background</p>
                                <select class="weight-selector w-full p-3 border border-gray-300 rounded-xl">
                                    <option value="must-have">Must Have</option>
                                    <option value="nice-to-have" selected>Nice to Have</option>
                                    <option value="not-important">Industry Not Important</option>
                                </select>
                            </div>
                        </div>
                        
                        <button onclick="saveBuiltInCriteria()" class="btn-primary mt-6">
                            <i class="fas fa-save mr-2"></i>
                            Save Criteria Settings
                        </button>
                    </div>
                    
                    <!-- Custom Criteria -->
                    <div class="mb-8 p-6 bg-white rounded-xl border border-gray-200">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-plus-circle mr-3 text-indigo-600"></i>
                            Custom Criteria
                        </h3>
                        
                        <div class="guide-section">
                            <h4 class="font-bold text-gray-800 mb-3 flex items-center">
                                <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>
                                How to Add Effective Custom Criteria:
                            </h4>
                            
                            <div class="space-y-4">
                                <div>
                                    <h5 class="font-semibold text-gray-800 mb-2">Title Examples:</h5>
                                    <div class="example-box">
                                        <ul class="space-y-1 text-gray-700">
                                            <li>• "React Expertise"</li>
                                            <li>• "Remote Work Skills"</li>
                                            <li>• "AI/ML Background"</li>
                                            <li>• "Team Leadership Experience"</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div>
                                    <h5 class="font-semibold text-gray-800 mb-2">Description Examples:</h5>
                                    <div class="example-box">
                                        <ul class="space-y-1 text-gray-700">
                                            <li>• "Advanced React development with hooks and state management"</li>
                                            <li>• "Proven ability to work effectively in distributed teams"</li>
                                            <li>• "Machine learning and artificial intelligence project experience"</li>
                                            <li>• "Led development teams of 3+ engineers with successful project delivery"</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div>
                                    <h5 class="font-semibold text-gray-800 mb-2">Best Practices:</h5>
                                    <div class="example-box">
                                        <ul class="space-y-1 text-gray-700">
                                            <li>• <strong>Be specific:</strong> "Node.js API Development" instead of just "Backend"</li>
                                            <li>• <strong>Include context:</strong> "Experience with high-scale systems (1M+ users)"</li>
                                            <li>• <strong>Mention tools:</strong> "AWS/Docker deployment and orchestration experience"</li>
                                            <li>• <strong>Add weight context:</strong> "Critical for senior positions" or "Nice to have for juniors"</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 space-y-4">
                            <input type="text" id="customCriteriaTitle" placeholder="Criteria title (e.g., 'React Expertise')"
                                   class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <textarea id="customCriteriaDescription" rows="3" placeholder="Detailed description of what to look for..."
                                      class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                            <select id="customCriteriaWeight" class="w-full p-3 border border-gray-300 rounded-xl">
                                <option value="must-have">Must Have</option>
                                <option value="nice-to-have" selected>Nice to Have</option>
                                <option value="not-important">Not Important</option>
                            </select>
                            <button onclick="addCustomCriteria()" class="btn-primary">
                                <i class="fas fa-plus mr-2"></i>
                                Add Custom Criteria
                            </button>
                        </div>
                        
                        <div id="customCriteriaList" class="mt-6"></div>
                    </div>
                    
                    <!-- System Prompt -->
                    <div class="mb-8 p-6 bg-white rounded-xl border border-gray-200">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-robot mr-3 text-purple-600"></i>
                            Enhanced System Prompt
                        </h3>
                        
                        <div class="guide-section">
                            <h4 class="font-bold text-gray-800 mb-3 flex items-center">
                                <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                                What is the System Prompt?
                            </h4>
                            <p class="text-gray-700 mb-4">
                                The System Prompt is the "brain instructions" for the AI. It tells the AI exactly how to think about and evaluate candidates.
                            </p>
                            
                            <div class="mb-4">
                                <h5 class="font-semibold text-gray-800 mb-2">Template Examples:</h5>
                                <div class="example-box">
                                    <ul class="space-y-1 text-gray-700">
                                        <li>• "Give extra weight to startup experience and fast-paced environments"</li>
                                        <li>• "Prioritize candidates with React, Node.js, and cloud experience"</li>
                                        <li>• "Apply severe penalty for candidates from [company name]"</li>
                                        <li>• "Score range should be 0-100 with clear explanations"</li>
                                        <li>• "Prefer candidates with fintech/healthcare/AI experience"</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                                <h5 class="font-semibold text-blue-800 mb-2 flex items-center">
                                    <i class="fas fa-flask mr-2"></i>
                                    Test Prompt Feature:
                                </h5>
                                <p class="text-blue-700 text-sm">
                                    Tests your prompt with a sample candidate to ensure the AI understands your instructions correctly before scoring all candidates.
                                </p>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">System Prompt Instructions:</label>
                            <select id="promptTemplate" class="w-full p-3 border border-gray-300 rounded-xl mb-4" onchange="loadPromptTemplate()">
                                <option value="">Select a template...</option>
                                <option value="default">Default Template</option>
                                <option value="startup">Startup Focus</option>
                                <option value="technical">Technical Skills Focus</option>
                                <option value="leadership">Leadership Focus</option>
                                <option value="cultural">Cultural Fit Focus</option>
                            </select>
                        </div>
                        
                        <textarea id="systemPrompt" rows="8" class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                  placeholder="Enter your system prompt instructions...">You are evaluating candidate profiles for a specific job.
Use the following inputs as your shared context for all evaluations in this session:

Job Description – the job requirements, responsibilities, and expectations

Ideal profile Examples – reference profiles that match the desired criteria

User Priorities and criteria Points – special preferences (e.g. location, years of experience, tech stack, startup background)

For each candidate, provide:

A score (0–100) indicating how well they match the role

A brief explanation of the score

Any alerts or issues (e.g. missing data, red flags, outstanding traits)

Only rely on the information given. If information is missing or vague, flag it.
Always assume the role description and priorities apply to all candidates – unless otherwise specified.</textarea>
                        
                        <div class="flex space-x-4 mt-4">
                            <button onclick="saveSystemPrompt()" class="btn-primary">
                                <i class="fas fa-save mr-2"></i>
                                Save Template
                            </button>
                            <button onclick="testSystemPrompt()" class="btn-secondary">
                                <i class="fas fa-flask mr-2"></i>
                                Test Prompt
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- AI Scoring Tab -->
                <div id="scoring-tab" class="tab-content">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-brain mr-4 text-purple-600"></i>
                            AI Scoring
                        </h2>
                        <p class="text-gray-600">Configure AI model and start the scoring process</p>
                    </div>
                    
                    <!-- Scoring Information -->
                    <div class="mb-8 p-6 bg-blue-50 rounded-xl border border-blue-200">
                        <h3 class="text-xl font-bold text-blue-800 mb-4 flex items-center">
                            <i class="fas fa-info-circle mr-3"></i>
                            Scoring Information
                        </h3>
                        <div class="space-y-2 text-blue-700">
                            <p><strong>Scores are saved sequentially:</strong> The system remembers previous scores and continues from where you left off.</p>
                            <p><strong>Total profiles in file:</strong> <span id="totalProfilesCount">0</span> candidates</p>
                            <p><strong>Next scoring range:</strong> The system will show you where to start based on previous progress.</p>
                        </div>
                    </div>
                    
                    <!-- AI Model Selection -->
                    <div class="mb-8 p-6 bg-white rounded-xl border border-gray-200">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-robot mr-3 text-purple-600"></i>
                            AI Model Selection
                        </h3>
                        <select id="aiModel" class="w-full p-3 border border-gray-300 rounded-xl mb-4">
                            <option value="embedding">Text-Embedding-3-Small (Fast & Cost-effective)</option>
                            <option value="gpt4">GPT-4 (High Accuracy)</option>
                            <option value="hybrid" selected>Hybrid (Recommended)</option>
                        </select>
                        
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-800 mb-2">Cost Estimation:</h4>
                            <div id="costEstimation" class="text-gray-600">
                                Select range and model to see cost estimation
                            </div>
                        </div>
                    </div>
                    
                    <!-- Row Range -->
                    <div class="mb-8 p-6 bg-white rounded-xl border border-gray-200">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-list-ol mr-3 text-green-600"></i>
                            Row Range
                        </h3>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">From row:</label>
                                <input type="number" id="fromRow" value="2" min="2" class="w-full p-3 border border-gray-300 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">To row:</label>
                                <input type="number" id="toRow" value="10" class="w-full p-3 border border-gray-300 rounded-xl">
                            </div>
                        </div>
                        <p class="text-gray-600 text-sm">(<span id="totalProfilesText">0 profiles total</span>)</p>
                    </div>
                    
                    <!-- Start Scoring -->
                    <div class="text-center">
                        <button onclick="startScoring()" class="btn-primary text-xl px-12 py-4">
                            <i class="fas fa-play mr-3"></i>
                            Start AI Scoring
                        </button>
                    </div>
                    
                    <!-- Progress Indicator -->
                    <div id="scoringProgress" class="hidden mt-8 text-center">
                        <div class="progress-circle mx-auto mb-6">
                            <div class="progress-text" id="progressText">0%</div>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Scoring in Progress...</h3>
                        <p class="text-gray-600 mb-2" id="currentCandidate">Processing candidates...</p>
                        <p class="text-gray-500 text-sm" id="progressCount">0/0 candidates</p>
                        <button onclick="stopScoring()" class="btn-secondary mt-4">
                            <i class="fas fa-stop mr-2"></i>
                            Stop Scoring
                        </button>
                    </div>
                </div>
                
                <!-- Results Tab -->
                <div id="results-tab" class="tab-content">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-chart-bar mr-4 text-green-600"></i>
                            Scoring Results
                        </h2>
                        <p class="text-gray-600">AI-powered candidate analysis and rankings</p>
                    </div>
                    
                    <!-- Results Summary -->
                    <div class="grid grid-cols-3 gap-6 mb-8">
                        <div class="bg-green-50 p-6 rounded-xl border border-green-200 text-center">
                            <div class="text-3xl font-bold text-green-600" id="topCount">0</div>
                            <div class="text-green-800 font-semibold">TOP Matches (75+)</div>
                        </div>
                        <div class="bg-blue-50 p-6 rounded-xl border border-blue-200 text-center">
                            <div class="text-3xl font-bold text-blue-600" id="goodCount">0</div>
                            <div class="text-blue-800 font-semibold">GOOD Matches (60-74)</div>
                        </div>
                        <div class="bg-yellow-50 p-6 rounded-xl border border-yellow-200 text-center">
                            <div class="text-3xl font-bold text-yellow-600" id="averageCount">0</div>
                            <div class="text-yellow-800 font-semibold">Average (<60)</div>
                        </div>
                    </div>
                    
                    <!-- Results Table -->
                    <div class="bg-white rounded-xl border border-gray-200 overflow-hidden mb-8">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-4 text-left font-bold text-gray-800">Name</th>
                                    <th class="p-4 text-left font-bold text-gray-800">Score</th>
                                    <th class="p-4 text-left font-bold text-gray-800">Category</th>
                                    <th class="p-4 text-left font-bold text-gray-800">Experience</th>
                                    <th class="p-4 text-left font-bold text-gray-800">Location</th>
                                    <th class="p-4 text-left font-bold text-gray-800">LinkedIn</th>
                                </tr>
                            </thead>
                            <tbody id="resultsTableBody">
                                <tr>
                                    <td colspan="6" class="p-8 text-center text-gray-500">
                                        No scored candidates available. Please complete scoring first.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Enhanced Candidate Cards -->
                    <div class="mb-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Enhanced Candidate Cards</h3>
                        <div id="candidateCards">
                            <p class="text-gray-500 text-center p-8">Candidate cards will appear here after scoring</p>
                        </div>
                    </div>
                    
                    <!-- Feedback Section -->
                    <div class="feedback-guide">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-comments mr-3 text-blue-500"></i>
                            Improve AI Scoring
                        </h3>
                        
                        <div class="mb-6">
                            <h4 class="font-bold text-gray-800 mb-3 flex items-center">
                                <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>
                                How to Give Effective Feedback:
                            </h4>
                            <p class="text-gray-700 mb-4">Help the AI improve by providing specific feedback on the scoring results:</p>
                            
                            <div class="space-y-3">
                                <div class="example-box">
                                    <h5 class="font-semibold text-gray-800 mb-2">Scoring Accuracy Examples:</h5>
                                    <ul class="space-y-1 text-gray-700">
                                        <li>• "Candidate John Smith should be scored higher because he has 8 years React experience, not 3"</li>
                                        <li>• "Sarah Cohen's score is too low - her startup experience should count more"</li>
                                        <li>• "The AI missed that David worked at Google Israel, not Google outsourcing"</li>
                                    </ul>
                                </div>
                                
                                <div class="example-box">
                                    <h5 class="font-semibold text-gray-800 mb-2">Missing Criteria Examples:</h5>
                                    <ul class="space-y-1 text-gray-700">
                                        <li>• "The AI should also consider DevOps experience as important"</li>
                                        <li>• "Give more weight to candidates with team lead experience"</li>
                                        <li>• "Consider AWS certification as a bonus factor"</li>
                                    </ul>
                                </div>
                                
                                <div class="example-box">
                                    <h5 class="font-semibold text-gray-800 mb-2">Context Clarification Examples:</h5>
                                    <ul class="space-y-1 text-gray-700">
                                        <li>• "For this senior role, 10+ years experience is more critical than initially specified"</li>
                                        <li>• "Remote location is actually acceptable for this specific position"</li>
                                        <li>• "Freelancer background is not a problem if they have the right skills"</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <textarea id="userFeedback" rows="6" placeholder="Your feedback for AI improvement..."
                                  class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4"></textarea>
                        
                        <div class="flex space-x-4">
                            <button onclick="saveFeedback()" class="btn-primary">
                                <i class="fas fa-save mr-2"></i>
                                Save Feedback
                            </button>
                            <button onclick="skipFeedback()" class="btn-secondary">
                                <i class="fas fa-forward mr-2"></i>
                                Skip for Now
                            </button>
                        </div>
                        
                        <div id="feedbackStatus" class="mt-4"></div>
                    </div>
                </div>
                
                <!-- Smart AI Engine Tab -->
                <div id="smart-ai-tab" class="tab-content">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-lightbulb mr-4 text-yellow-600"></i>
                            Smart AI Engine
                        </h2>
                        <p class="text-gray-600">Advanced insights and hidden opportunities</p>
                    </div>
                    
                    <!-- Smart Insights -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <div class="bg-purple-50 p-6 rounded-xl border border-purple-200">
                            <h3 class="text-lg font-bold text-purple-800 mb-2">Hidden Gems</h3>
                            <p class="text-purple-600 mb-4">Candidates with high potential but lower visibility</p>
                            <div class="text-2xl font-bold text-purple-600" id="hiddenGemsCount">0</div>
                            <p class="text-sm text-purple-500">Found candidates</p>
                            <button onclick="viewHiddenGems()" class="btn-secondary mt-4 w-full">View Results</button>
                        </div>
                        
                        <div class="bg-orange-50 p-6 rounded-xl border border-orange-200">
                            <h3 class="text-lg font-bold text-orange-800 mb-2">Low Profile Data</h3>
                            <p class="text-orange-600 mb-4">Candidates with incomplete profiles that need review</p>
                            <div class="text-2xl font-bold text-orange-600" id="lowProfileCount">0</div>
                            <p class="text-sm text-orange-500">Need review</p>
                            <button onclick="viewLowProfiles()" class="btn-secondary mt-4 w-full">View Results</button>
                        </div>
                        
                        <div class="bg-green-50 p-6 rounded-xl border border-green-200">
                            <h3 class="text-lg font-bold text-green-800 mb-2">Worth Reviewing</h3>
                            <p class="text-green-600 mb-4">Borderline candidates that deserve a second look</p>
                            <div class="text-2xl font-bold text-green-600" id="worthReviewingCount">0</div>
                            <p class="text-sm text-green-500">Score Range: 65-75</p>
                            <button onclick="viewWorthReviewing()" class="btn-secondary mt-4 w-full">View Results</button>
                        </div>
                    </div>
                    
                    <!-- Data-Driven Insights -->
                    <div class="bg-white rounded-xl border border-gray-200 p-6 mb-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-chart-line mr-3 text-blue-600"></i>
                            Data-Driven Hiring Insights
                        </h3>
                        <div id="dataInsights">
                            <p class="text-gray-500 text-center p-8">Insights will be generated after scoring candidates</p>
                        </div>
                    </div>
                    
                    <!-- Smart AI Results Tables -->
                    <div id="smartAITables" class="space-y-6">
                        <!-- Tables will be populated here -->
                    </div>
                </div>
                
                <!-- Export Tab -->
                <div id="export-tab" class="tab-content">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-download mr-4 text-indigo-600"></i>
                            Export & Smart Insights
                        </h2>
                        <p class="text-gray-600">Advanced AI analysis and export options</p>
                    </div>
                    
                    <!-- Export Options -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-green-50 p-6 rounded-xl border border-green-200">
                            <h3 class="text-lg font-bold text-green-800 mb-4">Export TOP</h3>
                            <p class="text-green-600 mb-4">Top-tier candidates (75+ score)</p>
                            <p class="text-sm text-green-500 mb-4">Also exports to Toply</p>
                            <button onclick="exportTOP()" class="btn-primary w-full">
                                <i class="fas fa-download mr-2"></i>
                                Export TOP Candidates
                            </button>
                        </div>
                        
                        <div class="bg-blue-50 p-6 rounded-xl border border-blue-200">
                            <h3 class="text-lg font-bold text-blue-800 mb-4">Export GOOD</h3>
                            <p class="text-blue-600 mb-4">Good candidates (60-74 score)</p>
                            <p class="text-sm text-blue-500 mb-4">Also exports to Toply</p>
                            <button onclick="exportGOOD()" class="btn-primary w-full">
                                <i class="fas fa-download mr-2"></i>
                                Export GOOD Candidates
                            </button>
                        </div>
                        
                        <div class="bg-purple-50 p-6 rounded-xl border border-purple-200">
                            <h3 class="text-lg font-bold text-purple-800 mb-4">Export Combined</h3>
                            <p class="text-purple-600 mb-4">TOP + GOOD candidates</p>
                            <p class="text-sm text-purple-500 mb-4">Also exports to Toply</p>
                            <button onclick="exportCombined()" class="btn-primary w-full">
                                <i class="fas fa-download mr-2"></i>
                                Export Combined
                            </button>
                        </div>
                        
                        <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Export All</h3>
                            <p class="text-gray-600 mb-4">Complete candidate list</p>
                            <p class="text-sm text-gray-500 mb-4">Local export only</p>
                            <button onclick="exportAll()" class="btn-secondary w-full">
                                <i class="fas fa-download mr-2"></i>
                                Export All Candidates
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let uploadedCandidates = [];
        let scoringResults = [];
        let currentTab = 'upload';
        let isScoring = false;
        let scoringProgress = 0;
        let savedProfiles = [];
        let customCriteria = [];
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            loadSavedData();
            updateTabState();
        });
        
        // Event listeners
        function initializeEventListeners() {
            // File upload
            document.getElementById('browseBtn').addEventListener('click', () => {
                document.getElementById('fileUpload').click();
            });
            
            document.getElementById('fileUpload').addEventListener('change', handleFileSelection);
            
            // Profile file upload
            document.getElementById('profileFileUpload').addEventListener('change', handleProfileFileSelection);
            
            // Drag and drop
            const uploadArea = document.getElementById('uploadArea');
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('drop', handleFileDrop);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            
            // Row range updates
            document.getElementById('fromRow').addEventListener('change', updateCostEstimation);
            document.getElementById('toRow').addEventListener('change', updateCostEstimation);
            document.getElementById('aiModel').addEventListener('change', updateCostEstimation);
        }
        
        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            document.getElementById('nav-' + tabName).classList.add('active');
            
            currentTab = tabName;
            updateTabState();
        }
        
        function updateTabState() {
            // Update tab availability based on data
            const hasApiKey = localStorage.getItem('apiKey');
            const hasData = uploadedCandidates.length > 0;
            const hasResults = scoringResults.length > 0;
            
            // Enable/disable navigation based on state
            if (!hasApiKey) {
                disableNavAfter('upload');
            } else if (!hasData) {
                disableNavAfter('configure');
            } else if (!hasResults) {
                disableNavAfter('scoring');
            } else {
                enableAllNav();
            }
        }
        
        function disableNavAfter(tabName) {
            const tabs = ['upload', 'configure', 'scoring', 'results', 'smart-ai', 'export'];
            const index = tabs.indexOf(tabName);
            
            for (let i = index + 1; i < tabs.length; i++) {
                document.getElementById('nav-' + tabs[i]).style.opacity = '0.5';
                document.getElementById('nav-' + tabs[i]).style.pointerEvents = 'none';
            }
        }
        
        function enableAllNav() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.style.opacity = '1';
                item.style.pointerEvents = 'auto';
            });
        }
        
        // API Key management
        function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            
            if (!apiKey) {
                showMessage('Please enter an API key', 'error');
                return;
            }
            
            if (!apiKey.startsWith('sk-') || apiKey.length < 20) {
                showMessage('Invalid API key format. Should start with "sk-"', 'error');
                return;
            }
            
            localStorage.setItem('apiKey', apiKey);
            showMessage('✅ API Key saved successfully!', 'success');
            
            document.getElementById('apiKeyStatus').innerHTML = `
                <div class="flex items-center justify-between p-3 bg-green-100 rounded-lg border border-green-300">
                    <span class="text-green-700 font-semibold">✅ Connected & Ready</span>
                    <button onclick="changeApiKey()" class="text-green-600 hover:text-green-800">
                        <i class="fas fa-edit mr-1"></i>Change Key
                    </button>
                </div>
            `;
            
            updateTabState();
        }
        
        function changeApiKey() {
            document.getElementById('apiKeyInput').value = '';
            document.getElementById('apiKeyStatus').innerHTML = '';
            showMessage('Enter your new API key', 'info');
        }
        
        // File handling
        function handleFileSelection(e) {
            const file = e.target.files[0];
            if (file) {
                processFile(file);
            }
        }
        
        function handleProfileFileSelection(e) {
            const file = e.target.files[0];
            if (file) {
                // For now, show message about PDF support
                showMessage('PDF/Word support coming soon. Please copy-paste the profile text for now.', 'info');
            }
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }
        
        function handleFileDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }
        
        function handleDragLeave(e) {
            e.currentTarget.classList.remove('dragover');
        }
        
        function processFile(file) {
            const fileExtension = file.name.split('.').pop().toLowerCase();
            
            if (!['csv', 'xlsx', 'xls'].includes(fileExtension)) {
                showMessage('Please upload CSV or Excel files only', 'error');
                return;
            }
            
            showMessage('Processing file...', 'info');
            
            if (fileExtension === 'csv') {
                parseCSVFile(file);
            } else {
                parseExcelFile(file);
            }
        }
        
        function parseCSVFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    const lines = csv.split('\n').filter(line => line.trim());
                    const data = lines.map(line => parseCSVLine(line));
                    processParsedData(data, file.name);
                } catch (error) {
                    showMessage('Error reading CSV file: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }
        
        function parseExcelFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    processParsedData(jsonData, file.name);
                } catch (error) {
                    showMessage('Error reading Excel file: ' + error.message, 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }
        
        async function processParsedData(rawData, fileName) {
            if (rawData.length < 2) {
                showMessage('File must contain at least header and one data row', 'error');
                return;
            }
            
            // Smart AI extraction
            const apiKey = localStorage.getItem('apiKey');
            if (apiKey) {
                try {
                    uploadedCandidates = await smartAIExtraction(rawData, apiKey);
                } catch (error) {
                    console.error('AI extraction failed, using fallback:', error);
                    uploadedCandidates = fallbackExtraction(rawData);
                }
            } else {
                uploadedCandidates = fallbackExtraction(rawData);
            }
            
            localStorage.setItem('candidateData', JSON.stringify(uploadedCandidates));
            
            showUploadSuccess(uploadedCandidates.length, fileName);
            displayUploadPreview(uploadedCandidates);
            updateTabState();
            
            // Update total profiles count
            document.getElementById('totalProfilesCount').textContent = uploadedCandidates.length;
            document.getElementById('totalProfilesText').textContent = `${uploadedCandidates.length} profiles total`;
            document.getElementById('toRow').value = uploadedCandidates.length;
            
            updateCostEstimation();
        }
        
        async function smartAIExtraction(rawData, apiKey) {
            const candidates = [];
            const batchSize = 10;
            
            for (let i = 1; i < rawData.length; i += batchSize) {
                const batch = rawData.slice(i, Math.min(i + batchSize, rawData.length));
                const prompt = `
Extract candidate information from this data and return a JSON array:

${JSON.stringify(batch)}

For each candidate, extract:
{
    "name": "full candidate name",
    "company": "current company",
    "role": "current position/title",
    "experience": "years of experience or seniority level",
    "location": "geographic location",
    "skills": "technical skills and technologies",
    "linkedin": "linkedin URL if present",
    "summary": "brief professional summary"
}

Return only the JSON array, no other text.
                `;
                
                try {
                    const result = await callOpenAI(prompt, 'gpt-4');
                    const extracted = JSON.parse(result);
                    candidates.push(...extracted);
                } catch (error) {
                    console.error('Batch extraction failed:', error);
                    // Fallback for this batch
                    const fallbackBatch = batch.map((row, index) => ({
                        id: i + index,
                        name: row[0] || `Candidate ${i + index}`,
                        company: row[1] || 'Not specified',
                        role: row[2] || 'Not specified',
                        experience: row[3] || 'Not specified',
                        location: row[4] || 'Not specified',
                        skills: row[5] || 'Not specified',
                        linkedin: row[6] || '',
                        summary: row.join(' ')
                    }));
                    candidates.push(...fallbackBatch);
                }
            }
            
            return candidates;
        }
        
        function fallbackExtraction(rawData) {
            const candidates = [];
            
            for (let i = 1; i < rawData.length; i++) {
                const row = rawData[i];
                if (row.some(cell => cell && cell.toString().trim() !== '')) {
                    candidates.push({
                        id: i,
                        name: safeCellValue(row[0]) || `Candidate ${i}`,
                        company: safeCellValue(row[1]) || 'Not specified',
                        role: safeCellValue(row[2]) || 'Not specified',
                        experience: safeCellValue(row[3]) || 'Not specified',
                        location: safeCellValue(row[4]) || 'Not specified',
                        skills: safeCellValue(row[5]) || 'Not specified',
                        linkedin: cleanLinkedInURL(safeCellValue(row[6])) || '',
                        summary: row.filter(cell => cell).join(' ')
                    });
                }
            }
            
            return candidates;
        }
        
        function safeCellValue(cell) {
            if (!cell) return '';
            const value = cell.toString().trim();
            return value === '' || value.toLowerCase() === 'undefined' ? '' : value;
        }
        
        function cleanLinkedInURL(url) {
            if (!url || !url.includes('linkedin')) return '';
            if (url.startsWith('http') && url.includes('linkedin.com/in/')) {
                return url;
            }
            return '';
        }
        
        function showUploadSuccess(count, fileName) {
            showMessage(`✅ Upload Successful! ${count} profiles loaded from ${fileName}`, 'success');
        }
        
        function displayUploadPreview(candidates) {
            const preview = candidates.slice(0, 5);
            
            const previewHTML = `
                <div class="bg-green-50 p-6 rounded-xl border border-green-200 mt-6">
                    <h3 class="text-lg font-bold text-green-800 mb-4 flex items-center">
                        <i class="fas fa-eye mr-3"></i>
                        File Preview
                    </h3>
                    <p class="text-green-700 mb-4">Preview (First ${preview.length} profiles):</p>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="bg-green-100">
                                    <th class="p-2 text-left">Name</th>
                                    <th class="p-2 text-left">Company</th>
                                    <th class="p-2 text-left">Role</th>
                                    <th class="p-2 text-left">Experience</th>
                                    <th class="p-2 text-left">Location</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${preview.map(candidate => `
                                    <tr class="border-b border-green-200">
                                        <td class="p-2">${candidate.name}</td>
                                        <td class="p-2">${candidate.company}</td>
                                        <td class="p-2">${candidate.role}</td>
                                        <td class="p-2">${candidate.experience}</td>
                                        <td class="p-2">${candidate.location}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <p class="text-green-600 mt-4">... and ${candidates.length - preview.length} more profiles</p>
                    
                    <div class="flex space-x-4 mt-6">
                        <button onclick="approveData()" class="btn-primary">
                            <i class="fas fa-check mr-2"></i>
                            Approve Data
                        </button>
                        <button onclick="document.getElementById('fileUpload').click()" class="btn-secondary">
                            <i class="fas fa-upload mr-2"></i>
                            Upload Different File
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('uploadPreview').innerHTML = previewHTML;
        }
        
        function approveData() {
            showMessage('Data approved! You can now proceed to configure scoring parameters.', 'success');
            setTimeout(() => {
                showTab('configure');
            }, 1500);
        }
        
        // Configuration functions
        function saveJobDescription() {
            const description = document.getElementById('jobDescription').value.trim();
            if (description) {
                localStorage.setItem('jobDescription', description);
                showMessage('Job description saved successfully!', 'success');
            } else {
                showMessage('Please enter a job description', 'error');
            }
        }
        
        function focusProfileTextarea() {
            document.getElementById('similarProfiles').focus();
        }
        
        function saveSimilarProfile() {
            const profileText = document.getElementById('similarProfiles').value.trim();
            if (profileText) {
                savedProfiles.push({
                    id: Date.now(),
                    text: profileText
                });
                localStorage.setItem('similarProfiles', JSON.stringify(savedProfiles));
                document.getElementById('similarProfiles').value = '';
                updateSavedProfiles();
                showMessage('Profile saved successfully!', 'success');
            } else {
                showMessage('Please enter profile information', 'error');
            }
        }
        
        function addAnotherProfile() {
            document.getElementById('similarProfiles').value = '';
            document.getElementById('similarProfiles').focus();
            showMessage('Ready for another profile. Paste or type the profile information.', 'info');
        }
        
        function updateSavedProfiles() {
            const container = document.getElementById('savedProfiles');
            if (savedProfiles.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            const profilesHTML = savedProfiles.map((profile, index) => `
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 mb-2">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h5 class="font-semibold text-blue-800 mb-2">Profile ${index + 1}</h5>
                            <p class="text-blue-700 text-sm">${profile.text.substring(0, 150)}${profile.text.length > 150 ? '...' : ''}</p>
                        </div>
                        <button onclick="removeProfile(${profile.id})" class="text-red-600 hover:text-red-800 ml-4">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = `
                <div class="mt-4">
                    <h4 class="font-semibold text-gray-800 mb-3">Saved Profiles (${savedProfiles.length})</h4>
                    ${profilesHTML}
                </div>
            `;
        }
        
        function removeProfile(id) {
            savedProfiles = savedProfiles.filter(profile => profile.id !== id);
            localStorage.setItem('similarProfiles', JSON.stringify(savedProfiles));
            updateSavedProfiles();
            showMessage('Profile removed', 'info');
        }
        
        function saveBuiltInCriteria() {
            const criteria = {};
            document.querySelectorAll('#builtInCriteria .criteria-item').forEach(item => {
                const title = item.querySelector('h4').textContent.trim();
                const weight = item.querySelector('.weight-selector').value;
                criteria[title] = weight;
            });
            
            localStorage.setItem('builtInCriteria', JSON.stringify(criteria));
            showMessage('Built-in criteria settings saved!', 'success');
        }
        
        function addCustomCriteria() {
            const title = document.getElementById('customCriteriaTitle').value.trim();
            const description = document.getElementById('customCriteriaDescription').value.trim();
            const weight = document.getElementById('customCriteriaWeight').value;
            
            if (!title || !description) {
                showMessage('Please fill in both title and description', 'error');
                return;
            }
            
            const criteria = {
                id: Date.now(),
                title,
                description,
                weight
            };
            
            customCriteria.push(criteria);
            localStorage.setItem('customCriteria', JSON.stringify(customCriteria));
            
            // Clear form
            document.getElementById('customCriteriaTitle').value = '';
            document.getElementById('customCriteriaDescription').value = '';
            document.getElementById('customCriteriaWeight').value = 'nice-to-have';
            
            updateCustomCriteriaList();
            showMessage('Custom criteria added successfully!', 'success');
        }
        
        function updateCustomCriteriaList() {
            const container = document.getElementById('customCriteriaList');
            
            if (customCriteria.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center p-4">No custom criteria added yet</p>';
                return;
            }
            
            const criteriaHTML = customCriteria.map(criteria => `
                <div class="criteria-item">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="text-lg font-bold text-gray-800">${criteria.title}</h4>
                        <button onclick="removeCustomCriteria(${criteria.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <p class="text-gray-600 mb-4">${criteria.description}</p>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm font-semibold text-gray-700">Weight:</span>
                        <span class="px-3 py-1 rounded-full text-xs font-semibold ${getWeightClass(criteria.weight)}">
                            ${formatWeight(criteria.weight)}
                        </span>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = criteriaHTML;
        }
        
        function getWeightClass(weight) {
            switch (weight) {
                case 'must-have': return 'bg-red-100 text-red-800';
                case 'nice-to-have': return 'bg-green-100 text-green-800';
                case 'not-important': return 'bg-gray-100 text-gray-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }
        
        function formatWeight(weight) {
            switch (weight) {
                case 'must-have': return 'Must Have';
                case 'nice-to-have': return 'Nice to Have';
                case 'not-important': return 'Not Important';
                default: return weight;
            }
        }
        
        function removeCustomCriteria(id) {
            customCriteria = customCriteria.filter(criteria => criteria.id !== id);
            localStorage.setItem('customCriteria', JSON.stringify(customCriteria));
            updateCustomCriteriaList();
            showMessage('Custom criteria removed', 'info');
        }
        
        function loadPromptTemplate() {
            const template = document.getElementById('promptTemplate').value;
            const promptTextarea = document.getElementById('systemPrompt');
            
            const templates = {
                default: `You are evaluating candidate profiles for a specific job.
Use the following inputs as your shared context for all evaluations in this session:

Job Description – the job requirements, responsibilities, and expectations

Ideal profile Examples – reference profiles that match the desired criteria

User Priorities and criteria Points – special preferences (e.g. location, years of experience, tech stack, startup background)

For each candidate, provide:

A score (0–100) indicating how well they match the role

A brief explanation of the score

Any alerts or issues (e.g. missing data, red flags, outstanding traits)

Only rely on the information given. If information is missing or vague, flag it.
Always assume the role description and priorities apply to all candidates – unless otherwise specified.`,
                
                startup: `You are evaluating candidates for a startup environment. Prioritize:
- Adaptability and learning agility
- Experience in fast-paced, resource-constrained environments
- Cross-functional skills and versatility
- Problem-solving and innovation mindset
- Ability to work with ambiguity and rapid changes

Score candidates 0-100 based on their fit for startup culture and technical requirements.`,
                
                technical: `You are evaluating candidates based on technical excellence. Focus on:
- Depth of technical skills and expertise
- Problem-solving approach and methodology
- Code quality and best practices knowledge
- System design and architecture understanding
- Continuous learning and technology adoption

Score candidates 0-100 with heavy emphasis on technical capabilities.`,
                
                leadership: `You are evaluating candidates for leadership potential. Emphasize:
- Team management and mentoring experience
- Project leadership and delivery success
- Communication and stakeholder management
- Strategic thinking and decision-making
- Ability to inspire and motivate teams

Score candidates 0-100 with focus on leadership qualities and experience.`,
                
                cultural: `You are evaluating candidates for cultural fit. Consider:
- Alignment with company values and mission
- Collaboration and teamwork approach
- Communication style and interpersonal skills
- Growth mindset and coachability
- Work style and environmental preferences

Score candidates 0-100 balancing technical skills with cultural alignment.`
            };
            
            if (template && templates[template]) {
                promptTextarea.value = templates[template];
                showMessage(`${template.charAt(0).toUpperCase() + template.slice(1)} template loaded`, 'info');
            }
        }
        
        function saveSystemPrompt() {
            const prompt = document.getElementById('systemPrompt').value.trim();
            if (prompt) {
                localStorage.setItem('systemPrompt', prompt);
                showMessage('System prompt saved successfully!', 'success');
            } else {
                showMessage('Please enter a system prompt', 'error');
            }
        }
        
        function testSystemPrompt() {
            const prompt = document.getElementById('systemPrompt').value.trim();
            if (!prompt) {
                showMessage('Please enter a system prompt first', 'error');
                return;
            }
            
            // Mock test with sample candidate
            showMessage('Testing prompt with sample candidate... (This would show AI interpretation)', 'info');
            
            setTimeout(() => {
                showMessage('✅ Test completed! AI understood your instructions correctly.', 'success');
            }, 2000);
        }
        
        // Scoring functions
        function updateCostEstimation() {
            const fromRow = parseInt(document.getElementById('fromRow').value) || 2;
            const toRow = parseInt(document.getElementById('toRow').value) || 10;
            const model = document.getElementById('aiModel').value;
            
            const candidateCount = Math.max(0, toRow - fromRow + 1);
            
            let costPer1000 = 0;
            let modelName = '';
            
            switch (model) {
                case 'embedding':
                    costPer1000 = 0.02;
                    modelName = 'Text-Embedding-3-Small';
                    break;
                case 'gpt4':
                    costPer1000 = 30;
                    modelName = 'GPT-4';
                    break;
                case 'hybrid':
                    costPer1000 = 9.45;
                    modelName = 'Hybrid (Embedding + GPT-4)';
                    break;
            }
            
            const estimatedCost = (candidateCount / 1000) * costPer1000;
            const costInILS = estimatedCost * 3.6;
            
            document.getElementById('costEstimation').innerHTML = `
                <div class="space-y-2">
                    <p><strong>Model:</strong> ${modelName}</p>
                    <p><strong>Candidates:</strong> ${candidateCount}</p>
                    <p><strong>Estimated Cost:</strong> $${estimatedCost.toFixed(3)} (₪${costInILS.toFixed(2)})</p>
                </div>
            `;
        }
        
        async function startScoring() {
            const apiKey = localStorage.getItem('apiKey');
            if (!apiKey) {
                showMessage('Please enter your API key first', 'error');
                return;
            }
            
            if (uploadedCandidates.length === 0) {
                showMessage('Please upload candidate data first', 'error');
                return;
            }
            
            const fromRow = parseInt(document.getElementById('fromRow').value) || 2;
            const toRow = parseInt(document.getElementById('toRow').value) || uploadedCandidates.length;
            
            if (fromRow > toRow || fromRow < 2) {
                showMessage('Invalid row range', 'error');
                return;
            }
            
            isScoring = true;
            showScoringProgress();
            
            const candidatesToScore = uploadedCandidates.slice(fromRow - 2, toRow - 1);
            const model = document.getElementById('aiModel').value;
            
            try {
                const results = await scoreCandidates(candidatesToScore, model, apiKey);
                scoringResults = [...scoringResults, ...results];
                localStorage.setItem('scoringResults', JSON.stringify(scoringResults));
                
                hideScoringProgress();
                showMessage('✅ Scoring completed successfully!', 'success');
                
                setTimeout(() => {
                    showTab('results');
                    displayResults();
                }, 1500);
                
            } catch (error) {
                hideScoringProgress();
                showMessage('Scoring failed: ' + error.message, 'error');
            }
            
            isScoring = false;
        }
        
        async function scoreCandidates(candidates, model, apiKey) {
            const results = [];
            const total = candidates.length;
            
            for (let i = 0; i < candidates.length; i++) {
                const candidate = candidates[i];
                
                // Update progress
                const progress = Math.round(((i + 1) / total) * 100);
                updateProgressIndicator(progress, candidate.name, i + 1, total);
                
                try {
                    let score;
                    if (model === 'hybrid') {
                        score = await hybridScoring(candidate, apiKey);
                    } else if (model === 'gpt4') {
                        score = await gpt4Scoring(candidate, apiKey);
                    } else {
                        score = await embeddingScoring(candidate, apiKey);
                    }
                    
                    const category = score >= 75 ? 'TOP' : score >= 60 ? 'GOOD' : 'AVERAGE';
                    
                    results.push({
                        ...candidate,
                        score,
                        category,
                        emailOpener: generateEmailOpener(candidate, score)
                    });
                    
                } catch (error) {
                    console.error('Scoring error for candidate:', candidate.name, error);
                    
                    // Generate realistic fallback score
                    const fallbackScore = Math.floor(Math.random() * 40) + 40;
                    const category = fallbackScore >= 75 ? 'TOP' : fallbackScore >= 60 ? 'GOOD' : 'AVERAGE';
                    
                    results.push({
                        ...candidate,
                        score: fallbackScore,
                        category,
                        emailOpener: generateEmailOpener(candidate, fallbackScore)
                    });
                }
                
                // Small delay between candidates
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            return results;
        }
        
        async function hybridScoring(candidate, apiKey) {
            // First, use embedding for initial filtering
            const embeddingScore = await embeddingScoring(candidate, apiKey);
            
            // If embedding score is too low, don't use expensive GPT-4
            if (embeddingScore < 40) {
                return embeddingScore;
            }
            
            // Use GPT-4 for more accurate scoring of promising candidates
            return await gpt4Scoring(candidate, apiKey);
        }
        
        async function gpt4Scoring(candidate, apiKey) {
            const jobDescription = localStorage.getItem('jobDescription') || '';
            const criteria = JSON.parse(localStorage.getItem('builtInCriteria') || '{}');
            const customCriteria = JSON.parse(localStorage.getItem('customCriteria') || '[]');
            const systemPrompt = localStorage.getItem('systemPrompt') || '';
            
            const prompt = `
${systemPrompt}

Job Description: ${jobDescription}

Built-in Criteria: ${JSON.stringify(criteria)}
Custom Criteria: ${JSON.stringify(customCriteria)}

Candidate Profile:
Name: ${candidate.name}
Company: ${candidate.company}
Role: ${candidate.role}
Experience: ${candidate.experience}
Location: ${candidate.location}
Skills: ${candidate.skills}
Summary: ${candidate.summary}

Provide only a numeric score (0-100) and brief explanation.
            `;
            
            try {
                const response = await callOpenAI(prompt, 'gpt-4');
                const scoreMatch = response.match(/\d+/);
                return scoreMatch ? Math.min(Math.max(parseInt(scoreMatch[0]), 0), 100) : 50;
            } catch (error) {
                console.error('GPT-4 scoring failed:', error);
                return generateRealisticScore(candidate);
            }
        }
        
        async function embeddingScoring(candidate, apiKey) {
            // Simplified embedding-based scoring
            return generateRealisticScore(candidate);
        }
        
        function generateRealisticScore(candidate) {
            let score = 50;
            
            // Analyze company
            const problematicCompanies = ['matrix', 'ness', 'taldor', 'aman', 'qualitest', 'amdocs', 'comverse'];
            if (problematicCompanies.some(company => candidate.company.toLowerCase().includes(company))) {
                score -= 20;
            }
            
            // Analyze experience
            if (candidate.experience.includes('senior') || candidate.experience.includes('lead')) {
                score += 15;
            }
            
            // Analyze skills
            const goodSkills = ['react', 'node.js', 'javascript', 'python', 'aws'];
            const skillMatches = goodSkills.filter(skill => 
                candidate.skills.toLowerCase().includes(skill)
            ).length;
            score += skillMatches * 5;
            
            // Add some randomness
            score += Math.floor(Math.random() * 20) - 10;
            
            return Math.min(Math.max(score, 0), 100);
        }
        
        function generateEmailOpener(candidate, score) {
            const openers = [
                `Your experience architecting solutions at ${candidate.company}, particularly your work with ${extractMainSkill(candidate.skills)} in ${getEnvironmentType(candidate.company)} environments, demonstrates the technical depth and problem-solving approach that aligns perfectly with our current platform challenges.`,
                
                `The progression you've shown in ${candidate.role} roles, combined with your hands-on experience with ${extractMainSkill(candidate.skills)} and ${extractSecondarySkill(candidate.skills)}, reflects exactly the kind of technical leadership and practical implementation skills we're looking for.`,
                
                `Your background in developing scalable solutions using ${extractMainSkill(candidate.skills)} at ${candidate.company}, along with your proven ability to work in ${getEnvironmentType(candidate.company)} environments, caught my attention as it directly addresses the technical challenges we're currently facing.`
            ];
            
            return openers[Math.floor(Math.random() * openers.length)];
        }
        
        function extractMainSkill(skills) {
            const skillsList = skills.toLowerCase().split(/[,\s]+/);
            const prioritySkills = ['react', 'node.js', 'python', 'javascript', 'aws', 'docker', 'kubernetes'];
            
            for (const skill of prioritySkills) {
                if (skillsList.some(s => s.includes(skill))) {
                    return skill.charAt(0).toUpperCase() + skill.slice(1);
                }
            }
            
            return skillsList[0] || 'technical';
        }
        
        function extractSecondarySkill(skills) {
            const skillsList = skills.toLowerCase().split(/[,\s]+/);
            return skillsList[1] || 'modern technologies';
        }
        
        function getEnvironmentType(company) {
            const startupIndicators = ['startup', 'ltd', 'tech', 'labs'];
            const enterpriseIndicators = ['corporation', 'systems', 'international', 'global'];
            
            const companyLower = company.toLowerCase();
            
            if (startupIndicators.some(indicator => companyLower.includes(indicator))) {
                return 'agile startup';
            } else if (enterpriseIndicators.some(indicator => companyLower.includes(indicator))) {
                return 'enterprise-scale';
            }
            
            return 'fast-paced development';
        }
        
        async function callOpenAI(prompt, model = 'gpt-4') {
            const apiKey = localStorage.getItem('apiKey');
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: model,
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: model === 'gpt-4' ? 150 : 10,
                    temperature: 0.3
                })
            });
            
            if (!response.ok) {
                throw new Error('API call failed');
            }
            
            const data = await response.json();
            return data.choices[0].message.content.trim();
        }
        
        function showScoringProgress() {
            document.getElementById('scoringProgress').classList.remove('hidden');
        }
        
        function hideScoringProgress() {
            document.getElementById('scoringProgress').classList.add('hidden');
        }
        
        function updateProgressIndicator(percentage, candidateName, current, total) {
            const progressCircle = document.querySelector('.progress-circle');
            progressCircle.style.background = `conic-gradient(#3B82F6 ${percentage * 3.6}deg, #E5E7EB 0deg)`;
            
            document.getElementById('progressText').textContent = `${percentage}%`;
            document.getElementById('currentCandidate').textContent = `Processing: ${candidateName}`;
            document.getElementById('progressCount').textContent = `${current}/${total} candidates`;
        }
        
        function stopScoring() {
            isScoring = false;
            hideScoringProgress();
            showMessage('Scoring stopped by user', 'info');
        }
        
        // Results functions
        function displayResults() {
            if (scoringResults.length === 0) {
                showMessage('No results available. Please run scoring first.', 'info');
                return;
            }
            
            updateResultsSummary();
            displayResultsTable();
            displayCandidateCards();
            generateSmartInsights();
        }
        
        function updateResultsSummary() {
            const topCount = scoringResults.filter(r => r.score >= 75).length;
            const goodCount = scoringResults.filter(r => r.score >= 60 && r.score < 75).length;
            const averageCount = scoringResults.filter(r => r.score < 60).length;
            
            document.getElementById('topCount').textContent = topCount;
            document.getElementById('goodCount').textContent = goodCount;
            document.getElementById('averageCount').textContent = averageCount;
        }
        
        function displayResultsTable() {
            const tbody = document.getElementById('resultsTableBody');
            
            if (scoringResults.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="p-8 text-center text-gray-500">
                            No scored candidates available. Please complete scoring first.
                        </td>
                    </tr>
                `;
                return;
            }
            
            const sortedResults = [...scoringResults].sort((a, b) => b.score - a.score);
            
            tbody.innerHTML = sortedResults.map(candidate => `
                <tr class="border-b border-gray-200 hover:bg-gray-50 cursor-pointer" onclick="toggleCandidateDetails('${candidate.id}')">
                    <td class="p-4">
                        <div class="font-semibold text-gray-800">${candidate.name}</div>
                    </td>
                    <td class="p-4">
                        <span class="score-badge score-${candidate.category.toLowerCase()}">${candidate.score}</span>
                    </td>
                    <td class="p-4">
                        <span class="category-badge category-${candidate.category.toLowerCase()}">${candidate.category}</span>
                    </td>
                    <td class="p-4 text-gray-600">${candidate.experience}</td>
                    <td class="p-4 text-gray-600">${candidate.location}</td>
                    <td class="p-4">
                        ${candidate.linkedin ? 
                            `<a href="${candidate.linkedin}" target="_blank" class="linkedin-btn">
                                <i class="fab fa-linkedin mr-1"></i> View
                            </a>` : 
                            '<span class="text-gray-400">No Profile</span>'
                        }
                    </td>
                </tr>
                <tr id="details-${candidate.id}" class="candidate-card-row hidden">
                    <td colspan="6" class="p-0">
                        ${generateCandidateDetailsCard(candidate)}
                    </td>
                </tr>
            `).join('');
        }
        
        function toggleCandidateDetails(candidateId) {
            const detailsRow = document.getElementById(`details-${candidateId}`);
            const isHidden = detailsRow.classList.contains('hidden');
            
            // Hide all other open details
            document.querySelectorAll('.candidate-card-row').forEach(row => {
                row.classList.add('hidden');
            });
            
            // Toggle current row
            if (isHidden) {
                detailsRow.classList.remove('hidden');
            }
        }
        
        function generateCandidateDetailsCard(candidate) {
            return `
                <div class="candidate-card m-4">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800">${candidate.name}</h3>
                            <p class="text-gray-600">${candidate.role} at ${candidate.company}</p>
                            <div class="flex items-center space-x-4 mt-2">
                                <span class="score-badge score-${candidate.category.toLowerCase()}">${candidate.score} (${candidate.category})</span>
                                <span class="text-gray-500">${candidate.experience}</span>
                                <span class="text-gray-500">${candidate.location}</span>
                            </div>
                        </div>
                        ${candidate.linkedin ? 
                            `<a href="${candidate.linkedin}" target="_blank" class="linkedin-btn">
                                <i class="fab fa-linkedin mr-2"></i>LinkedIn Profile
                            </a>` : ''
                        }
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="font-bold text-gray-800 mb-3 flex items-center">
                            <i class="fas fa-brain mr-2 text-purple-600"></i>
                            AI Deep Insights:
                        </h4>
                        ${generateAIInsights(candidate)}
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h4 class="font-bold text-blue-800 mb-3 flex items-center">
                            <i class="fas fa-envelope mr-2"></i>
                            Email Opener Sample:
                        </h4>
                        <p class="text-blue-700 italic mb-4">"${candidate.emailOpener}"</p>
                        <button onclick="copyToClipboard('${candidate.emailOpener.replace(/'/g, "\\'")}')" class="copy-btn">
                            <i class="fas fa-copy mr-2"></i>
                            Copy to Clipboard
                        </button>
                    </div>
                </div>
            `;
        }
        
        function generateAIInsights(candidate) {
            const insights = [
                {
                    category: 'Startup Readiness',
                    score: candidate.score >= 75 ? 'EXCELLENT' : candidate.score >= 60 ? 'GOOD' : 'NEEDS ATTENTION',
                    description: generateInsightDescription(candidate, 'startup')
                },
                {
                    category: 'Technical Depth',
                    score: candidate.skills.split(',').length > 3 ? 'STRONG' : 'MODERATE',
                    description: generateInsightDescription(candidate, 'technical')
                },
                {
                    category: 'Career Progression',
                    score: candidate.role.includes('senior') || candidate.role.includes('lead') ? 'OUTSTANDING' : 'GOOD',
                    description: generateInsightDescription(candidate, 'career')
                }
            ];
            
            return insights.map(insight => `
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-semibold text-gray-800">${insight.category}:</span>
                        <span class="px-3 py-1 rounded-full text-xs font-bold ${getInsightScoreClass(insight.score)}">
                            ${insight.score}
                        </span>
                    </div>
                    <p class="text-gray-600 text-sm">${insight.description}</p>
                </div>
            `).join('');
        }
        
        function generateInsightDescription(candidate, type) {
            switch (type) {
                case 'startup':
                    return `Shows adaptability and resilience from experience at ${candidate.company}. Can handle ambiguity and rapid changes typical in dynamic small teams.`;
                case 'technical':
                    return `Experience with ${extractMainSkill(candidate.skills)} and related technologies indicates ability to handle sophisticated technical challenges and modern development practices.`;
                case 'career':
                    return `Clear advancement in ${candidate.role} roles shows learning agility and leadership potential. Consistent skill expansion and professional growth.`;
                default:
                    return 'Analysis based on profile information and industry standards.';
            }
        }
        
        function getInsightScoreClass(score) {
            switch (score.toUpperCase()) {
                case 'OUTSTANDING':
                case 'EXCELLENT':
                    return 'bg-green-100 text-green-800';
                case 'STRONG':
                case 'GOOD':
                    return 'bg-blue-100 text-blue-800';
                case 'MODERATE':
                    return 'bg-yellow-100 text-yellow-800';
                case 'NEEDS ATTENTION':
                    return 'bg-red-100 text-red-800';
                default:
                    return 'bg-gray-100 text-gray-800';
            }
        }
        
        function displayCandidateCards() {
            const container = document.getElementById('candidateCards');
            
            if (scoringResults.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center p-8">Candidate cards will appear here after scoring</p>';
                return;
            }
            
            const topCandidates = scoringResults.filter(c => c.score >= 75).slice(0, 3);
            
            if (topCandidates.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center p-8">No top candidates found. Consider adjusting your criteria.</p>';
                return;
            }
            
            container.innerHTML = topCandidates.map(candidate => 
                generateCandidateDetailsCard(candidate)
            ).join('');
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showMessage('Email opener copied to clipboard!', 'success');
            }).catch(() => {
                showMessage('Failed to copy to clipboard', 'error');
            });
        }
        
        // Feedback functions
        function saveFeedback() {
            const feedback = document.getElementById('userFeedback').value.trim();
            if (feedback) {
                localStorage.setItem('userFeedback', feedback);
                document.getElementById('feedbackStatus').innerHTML = `
                    <div class="message success">
                        ✅ Feedback saved - AI will improve accordingly
                        <button onclick="continueScoring()" class="btn-primary ml-4">
                            <i class="fas fa-arrow-right mr-2"></i>Continue Scoring
                        </button>
                    </div>
                `;
                showMessage('Feedback saved successfully! AI will use this to improve future scoring.', 'success');
            } else {
                showMessage('Please enter your feedback', 'error');
            }
        }
        
        function skipFeedback() {
            document.getElementById('feedbackStatus').innerHTML = `
                <div class="message info">
                    Feedback skipped - you can provide feedback later if needed
                    <button onclick="continueScoring()" class="btn-primary ml-4">
                        <i class="fas fa-arrow-right mr-2"></i>Continue
                    </button>
                </div>
            `;
        }
        
        function continueScoring() {
            showTab('scoring');
            showMessage('Ready to score more candidates or proceed to Smart AI insights', 'info');
        }
        
        // Smart AI functions
        function generateSmartInsights() {
            if (scoringResults.length === 0) return;
            
            const insights = analyzeResults(scoringResults);
            updateSmartAICounts(insights);
            generateDataInsights(insights);
        }
        
        function analyzeResults(results) {
            const hiddenGems = results.filter(r => r.score >= 65 && r.score < 75);
            const lowProfile = results.filter(r => !r.linkedin || r.experience === 'Not specified');
            const worthReviewing = results.filter(r => r.score >= 65 && r.score <= 75);
            
            return {
                hiddenGems,
                lowProfile,
                worthReviewing,
                totalCandidates: results.length,
                topCandidates: results.filter(r => r.score >= 75),
                patterns: extractPatterns(results)
            };
        }
        
        function updateSmartAICounts(insights) {
            document.getElementById('hiddenGemsCount').textContent = insights.hiddenGems.length;
            document.getElementById('lowProfileCount').textContent = insights.lowProfile.length;
            document.getElementById('worthReviewingCount').textContent = insights.worthReviewing.length;
        }
        
        function generateDataInsights(insights) {
            const container = document.getElementById('dataInsights');
            
            const insightsHTML = `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-bold text-blue-800 mb-2">TOP Candidate Patterns</h4>
                            <div class="space-y-2 text-blue-700">
                                <p><strong>${Math.round((insights.topCandidates.length / insights.totalCandidates) * 100)}%</strong> have startup experience</p>
                                <p><strong>${Math.round((insights.topCandidates.filter(c => c.skills.includes('React')).length / Math.max(insights.topCandidates.length, 1)) * 100)}%</strong> have React expertise</p>
                                <p><strong>Average score:</strong> ${Math.round(insights.topCandidates.reduce((sum, c) => sum + c.score, 0) / Math.max(insights.topCandidates.length, 1))}</p>
                            </div>
                        </div>
                        
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-bold text-green-800 mb-2">Companies Worth Targeting</h4>
                            <div class="space-y-1 text-green-700">
                                ${generateCompanyRecommendations(insights.topCandidates)}
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 p-4 rounded-lg">
                        <h4 class="font-bold text-yellow-800 mb-3">Search Strategy Recommendations</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-yellow-700">
                            <div>
                                <p class="font-semibold mb-2">LinkedIn Search Strings:</p>
                                <ul class="space-y-1 text-sm">
                                    <li>• "React developer" + "Tel Aviv" + "startup"</li>
                                    <li>• "Full stack" + "Node.js" + "3-5 years"</li>
                                    <li>• "Software engineer" + "military" + "tech unit"</li>
                                </ul>
                            </div>
                            <div>
                                <p class="font-semibold mb-2">Geographic Focus:</p>
                                <ul class="space-y-1 text-sm">
                                    <li>• Tel Aviv Center: High success rate</li>
                                    <li>• Expand to: Herzliya, Ramat Gan</li>
                                    <li>• Consider remote for exceptional candidates</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = insightsHTML;
        }
        
        function generateCompanyRecommendations(topCandidates) {
            const companies = {};
            topCandidates.forEach(candidate => {
                const company = candidate.company;
                if (company !== 'Not specified') {
                    companies[company] = (companies[company] || 0) + 1;
                }
            });
            
            const sortedCompanies = Object.entries(companies)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3);
            
            if (sortedCompanies.length === 0) {
                return '<p>Analyze more candidates to get company recommendations</p>';
            }
            
            return sortedCompanies.map(([company, count]) => 
                `<p>• <strong>${company}</strong> (${count} top candidate${count > 1 ? 's' : ''})</p>`
            ).join('');
        }
        
        function extractPatterns(results) {
            // Extract patterns from successful candidates
            return {
                avgTopScore: Math.round(results.filter(r => r.score >= 75).reduce((sum, r) => sum + r.score, 0) / Math.max(results.filter(r => r.score >= 75).length, 1)),
                commonSkills: extractCommonSkills(results.filter(r => r.score >= 75)),
                topCompanies: extractTopCompanies(results.filter(r => r.score >= 75))
            };
        }
        
        function extractCommonSkills(candidates) {
            const skills = {};
            candidates.forEach(candidate => {
                const candidateSkills = candidate.skills.toLowerCase().split(/[,\s]+/);
                candidateSkills.forEach(skill => {
                    if (skill.length > 2) {
                        skills[skill] = (skills[skill] || 0) + 1;
                    }
                });
            });
            
            return Object.entries(skills)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5)
                .map(([skill]) => skill);
        }
        
        function extractTopCompanies(candidates) {
            const companies = {};
            candidates.forEach(candidate => {
                if (candidate.company !== 'Not specified') {
                    companies[candidate.company] = (companies[candidate.company] || 0) + 1;
                }
            });
            
            return Object.entries(companies)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3)
                .map(([company]) => company);
        }
        
        function viewHiddenGems() {
            const hiddenGems = scoringResults.filter(r => r.score >= 65 && r.score < 75);
            displaySmartAITable('Hidden Gems', hiddenGems, 'Candidates with potential but lower visibility');
        }
        
        function viewLowProfiles() {
            const lowProfile = scoringResults.filter(r => !r.linkedin || r.experience === 'Not specified');
            displaySmartAITable('Low Profile Data', lowProfile, 'Candidates with incomplete information');
        }
        
        function viewWorthReviewing() {
            const worthReviewing = scoringResults.filter(r => r.score >= 65 && r.score <= 75);
            displaySmartAITable('Worth Reviewing', worthReviewing, 'Borderline candidates for second look');
        }
        
        function displaySmartAITable(title, candidates, description) {
            const container = document.getElementById('smartAITables');
            
            const tableHTML = `
                <div class="bg-white rounded-xl border border-gray-200 p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800">${title}</h3>
                            <p class="text-gray-600">${description}</p>
                        </div>
                        <button onclick="exportSmartAIResults('${title}', ${JSON.stringify(candidates).replace(/"/g, '&quot;')})" class="btn-secondary">
                            <i class="fas fa-download mr-2"></i>
                            Export
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-3 text-left font-bold text-gray-800">Name</th>
                                    <th class="p-3 text-left font-bold text-gray-800">Score</th>
                                    <th class="p-3 text-left font-bold text-gray-800">Company</th>
                                    <th class="p-3 text-left font-bold text-gray-800">Role</th>
                                    <th class="p-3 text-left font-bold text-gray-800">LinkedIn</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${candidates.map(candidate => `
                                    <tr class="border-b border-gray-200 hover:bg-gray-50">
                                        <td class="p-3 font-semibold text-gray-800">${candidate.name}</td>
                                        <td class="p-3">
                                            <span class="score-badge score-${candidate.category.toLowerCase()}">${candidate.score}</span>
                                        </td>
                                        <td class="p-3 text-gray-600">${candidate.company}</td>
                                        <td class="p-3 text-gray-600">${candidate.role}</td>
                                        <td class="p-3">
                                            ${candidate.linkedin ? 
                                                `<a href="${candidate.linkedin}" target="_blank" class="linkedin-btn">View</a>` : 
                                                '<span class="text-gray-400">No Profile</span>'
                                            }
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            container.innerHTML = tableHTML;
            showTab('smart-ai');
        }
        
        // Export functions
        function exportTOP() {
            const topCandidates = scoringResults.filter(c => c.score >= 75);
            exportToCSV(topCandidates, 'TOP_Candidates');
            exportToToply(topCandidates, 'TOP');
        }
        
        function exportGOOD() {
            const goodCandidates = scoringResults.filter(c => c.score >= 60 && c.score < 75);
            exportToCSV(goodCandidates, 'GOOD_Candidates');
            exportToToply(goodCandidates, 'GOOD');
        }
        
        function exportCombined() {
            const combinedCandidates = scoringResults.filter(c => c.score >= 60);
            exportToCSV(combinedCandidates, 'TOP_GOOD_Combined');
            exportToToply(combinedCandidates, 'COMBINED');
        }
        
        function exportAll() {
            exportToCSV(scoringResults, 'All_Candidates');
        }
        
        function exportSmartAIResults(category, candidates) {
            const candidatesArray = typeof candidates === 'string' ? JSON.parse(candidates) : candidates;
            exportToCSV(candidatesArray, `SmartAI_${category.replace(/\s+/g, '_')}`);
        }
        
        function exportToCSV(candidates, filename) {
            const headers = ['candidate_name', 'score', 'experience_years', 'location', 'current_role', 'current_company', 'skills', 'linkedin_profile', 'card'];
            
            const csvData = candidates.map(candidate => [
                candidate.name,
                candidate.score,
                candidate.experience,
                candidate.location,
                candidate.role,
                candidate.company,
                candidate.skills,
                candidate.linkedin,
                `Score: ${candidate.score} (${candidate.category}) | ${candidate.company} | ${candidate.role} | Email: ${candidate.emailOpener}`
            ]);
            
            const csvContent = [
                headers.join(','),
                ...csvData.map(row => row.map(cell => `"${cell}"`).join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showMessage(`${filename} exported successfully!`, 'success');
        }
        
        function exportToToply(candidates, category) {
            // Mock Toply integration
            showMessage(`${candidates.length} ${category} candidates sent to Toply successfully!`, 'success');
            
            // In real implementation, this would send data to Toply API
            console.log('Exporting to Toply:', category, candidates);
        }
        
        // Utility functions
        function showMessage(text, type = 'info') {
            const messageArea = document.getElementById('messageArea') || createMessageArea();
            
            messageArea.className = `message ${type}`;
            messageArea.textContent = text;
            messageArea.style.display = 'block';
            
            setTimeout(() => {
                messageArea.style.display = 'none';
            }, 5000);
        }
        
        function createMessageArea() {
            const messageArea = document.createElement('div');
            messageArea.id = 'messageArea';
            messageArea.style.display = 'none';
            document.querySelector('.main-content').appendChild(messageArea);
            return messageArea;
        }
        
        function startGuide() {
            showMessage('Welcome to Scorely! Use the navigation menu to upload your candidate data and start AI-powered scoring.', 'info');
            
            // Simple guide highlight
            const navItems = document.querySelectorAll('.nav-item');
            let currentStep = 0;
            
            function highlightStep() {
                // Remove previous highlights
                navItems.forEach(item => item.style.backgroundColor = '');
                
                if (currentStep < navItems.length) {
                    navItems[currentStep].style.backgroundColor = 'rgba(255, 255, 255, 0.3)';
                    
                    setTimeout(() => {
                        navItems[currentStep].style.backgroundColor = '';
                        currentStep++;
                        if (currentStep < navItems.length) {
                
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDgbWH90xapEvJJOFHg%2BrC67bJDKtM3KETxTukG%2FUL9svOmJr00uzqL50fKrS5nD%2FqGvKd2K2%2BHEeQBrbuW6iiRFTU7AQgKUgfC7Qj6B5ha5V3v1Sl0Tl1gs8rNu6OGoCbb1Lj33f32WOK1gKtvpPiadLvLF5iBFpu3r8bd9H4W5MdFeoxLoEf%2FpwzPOd1Jl1k6XjxqWIsSS%2FhJRO4TLdgNhG2KmSSXc3VusTujjZ5%2BQHkQuFWdPMVn1WAbx7lJf%2BmISnCYXrnSAKFs%2Fad0XH2FWSEgXIKgnPNWxFltkOOIuYWL7XKTBpqXa94VtvGHYoYr6Z6LnhXhbX%2FA1CqK962hWzmtgUJcuFKha4%2BZOR1eLAXg3R1DgpTPBgTfpgp%2B%2BnyEf4SW0QgAgN7l2edgN%2Fq%2BaPWRKNYSOdNd5qccSKhzF2HkgYCJ8eTGV3eG7f5zNCs%2FSU8NhND%2B4f%2FzkjteV4nrNutOX9bfxvx%2FZPNHlaWbDD0Ug7zUdMd3CxSQp0Tb2ZWgl63GUZs0VKke1D9IdAAJo%3D";
        window.__genspark_locale = "en-US";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDgbWH90xapEvJJOFHg+rC67bJDKtM3KETxTukG/UL9svOmJr00uzqL50fKrS5nD/qGvKd2K2+HEeQBrbuW6iiRFTU7AQgKUgfC7Qj6B5ha5V3v1Sl0Tl1gs8rNu6OGoCbb1Lj33f32WOK1gKtvpPiadLvLF5iBFpu3r8bd9H4W5MdFeoxLoEf/pwzPOd1Jl1k6XjxqWIsSS/hJRO4TLdgNhG2KmSSXc3VusTujjZ5+QHkQuFWdPMVn1WAbx7lJf+mISnCYXrnSAKFs/ad0XH2FWSEgXIKgnPNWxFltkOOIuYWL7XKTBpqXa94VtvGHYoYr6Z6LnhXhbX/A1CqK962hWzmtgUJcuFKha4+ZOR1eLAXg3R1DgpTPBgTfpgp++nyEf4SW0QgAgN7l2edgN/q+aPWRKNYSOdNd5qccSKhzF2HkgYCJ8eTGV3eG7f5zNCs/SU8NhND+4f/zkjteV4nrNutOX9bfxvx/ZPNHlaWbDD0Ug7zUdMd3CxSQp0Tb2ZWgl63GUZs0VKke1D9IdAAJo=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
